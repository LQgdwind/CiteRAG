{
  "paper_id": "2406.09649v1",
  "title": "SquirrelFS: using the Rust compiler to check file-system crash consistency",
  "sections": {
    "crash consistency": "A file system is crash consistent if it can recover to a consistent state after a power loss or a crash   .\nA consistent file system is one where all the metadata is in sync; for example, two files cannot (mistakenly) claim the same data block.\nFiles present before the crash must exist post-crash, and the data in files must remain valid. Crash-consistency mechanisms. Crash consistency is generally achieved using mechanisms such as journaling  , copy-on-write   , or soft updates .\nThe root of crash consistency is correctly ordering writes to storage ; for example, a data block must be initialized before a file points to it.\nSoft updates achieves crash consistency by carefully ordering in-place updates to storage such that all possible crash states are consistent .\nTo enforce ordering, soft updates must track updates across asynchronous operations and resolve cyclic dependencies when they arise.\nThough soft updates is used in FreeBSD [ref]44, it has not been widely adopted due to its high complexity. Ensuring crash consistency. Ensuring that a given file system achieves crash consistency is challenging.\nThere are two main approaches.\nThe first approach is testing, in which possible crash states of a file system are explored and checked for consistency.\nObtaining these crash states requires support from tools like eXplode , CrashMonkey , Hydra , Chipmunk , or Vinter .\nWhile such testing tools can find many bugs, they cannot prove overall correctness or the absence of crash-consistency bugs. The second approach is to build verified file systems.\nA developer writes a high-level specification of correctness and a lower-level implementation, and proves that the implementation satisfies the specification.\nThis approach is stronger than testing in that it can prove strong correctness properties and verify that there are no bugs.\nHowever, it comes at a high cost: the developer has to write 7–13 lines of proof for every line of code.\nFor example, BilbyFS 2 required 13k lines of proof for 1k lines of implementation code; VeriBetrKV  used 45K lines of proof for 6k lines of implementation.\nAnother verified file system, FSCQ 9, has interleaved proof and implementation code that is 10×\\times the size of the most similar unverified system. This heavy proof burden constrains development in a number of ways.\nFirst, building a verified system requires proof-writing expertise, which restricts the set of developers who can work on it.\nSecond, proofs must be written in tandem with the code that they verify, which extends development time.\nFinally, making changes to the system requires corresponding changes to the proofs, making maintenance slow and preventing rapid updates. Corundum  is a Rust crate for PM systems that, like SquirrelFS, uses the Rust type system to enforce certain low-level PM safety properties at compile time.\nFor example, Corundum ensures that every update to PM occurs in a logged transaction, and prevents the storage of pointers to volatile memory in durable structures.\nSquirrelFS was inspired by Corundum and aims to enforce higher-level properties like file-system crash consistency with Rust."
  },
  "reference_labels": [
    {
      "index": 0,
      "title": "BTRFS documentation",
      "abstract": "",
      "year": "",
      "venue": "",
      "authors": ""
    },
    {
      "index": 1,
      "title": "Compute Express Link (CXL) specification",
      "abstract": "",
      "year": "",
      "venue": "",
      "authors": ""
    },
    {
      "index": 2,
      "title": "Direct Access for files",
      "abstract": "",
      "year": "",
      "venue": "",
      "authors": ""
    },
    {
      "index": 3,
      "title": "Filebench",
      "abstract": "",
      "year": "",
      "venue": "",
      "authors": ""
    },
    {
      "index": 4,
      "title": "Linux test project",
      "abstract": "",
      "year": "",
      "venue": "",
      "authors": ""
    },
    {
      "index": 5,
      "title": "LMDB",
      "abstract": "",
      "year": "",
      "venue": "",
      "authors": ""
    },
    {
      "index": 6,
      "title": "Rocksdb",
      "abstract": "",
      "year": "",
      "venue": "",
      "authors": ""
    },
    {
      "index": 7,
      "title": "Rust for linux",
      "abstract": "",
      "year": "",
      "venue": "",
      "authors": ""
    },
    {
      "index": 8,
      "title": "Typestate programming",
      "abstract": "",
      "year": "",
      "venue": "",
      "authors": ""
    },
    {
      "index": 9,
      "title": "xfstests",
      "abstract": "",
      "year": "",
      "venue": "",
      "authors": ""
    },
    {
      "index": 10,
      "title": "Typestate-oriented programming",
      "abstract": "",
      "year": "2009",
      "venue": "ACM SIGPLAN Conference Companion on Object Oriented Programming Systems Languages and Applications",
      "authors": "Jonathan Aldrich, Joshua Sunshine, Darpan Saini, and Zachary Sparks"
    },
    {
      "index": 11,
      "title": "Cogent: Verifying high-assurance file system implementations",
      "abstract": "",
      "year": "2016",
      "venue": "International Conference on Architectural Support for Programming Languages and Operating Systems",
      "authors": "Sidney Amani, Alex Hixon, Zilin Chen, Christine Rizkallah, Peter Chubb, Liam O’Connor, Joel Beeren, Yutaka Nagashima, Japheth Lim, Thomas Sewell, Joseph Tuong, Gabriele Keller, Toby Murray, Gerwin Klein, and Gernot Heiser"
    },
    {
      "index": 12,
      "title": "Soft updates, hard problems",
      "abstract": "",
      "year": "2009",
      "venue": "",
      "authors": "Valerie Aurora"
    },
    {
      "index": 13,
      "title": "Exploring the Software Ecosystem for Compute Express Link (CXL) Memory",
      "abstract": "",
      "year": "2023",
      "venue": "",
      "authors": "Piotr Balcer"
    },
    {
      "index": 14,
      "title": "Using lightweight formal methods to validate a key-value storage node in Amazon S3",
      "abstract": "",
      "year": "2021",
      "venue": "ACM SIGOPS Symposium on Operating Systems Principles",
      "authors": "James Bornholt, Rajeev Joshi, Vytautas Astrauskas, Brendan Cully, Bernhard Kragl, Seth Markle, Kyle Sauri, Drew Schleit, Grant Slatton, Serdar Tasiran, Jacob Van Geffen, and Andrew Warfield"
    },
    {
      "index": 15,
      "title": "Specifying and checking file system crash-consistency models",
      "abstract": "",
      "year": "2016",
      "venue": "International Conference on Architectural Support for Programming Languages and Operating Systems",
      "authors": "James Bornholt, Antoine Kaufmann, Jialin Li, Arvind Krishnamurthy, Emina Torlak, and Xi Wang"
    },
    {
      "index": 16,
      "title": "Verifying the DaisyNFS concurrent and crash-safe file system with sequential reasoning",
      "abstract": "",
      "year": "2022",
      "venue": "USENIX Symposium on Operating Systems Design and Implementation",
      "authors": "Tej Chajed, Joseph Tassarotti, Mark Theng, M. Frans Kaashoek, and Nickolai Zeldovich"
    },
    {
      "index": 17,
      "title": "Verifying a high-performance crash-safe file system using a tree specification",
      "abstract": "",
      "year": "2017",
      "venue": "Symposium on Operating Systems Principles",
      "authors": "Haogang Chen, Tej Chajed, Alex Konradi, Stephanie Wang, Atalay İleri, Adam Chlipala, M. Frans Kaashoek, and Nickolai Zeldovich"
    },
    {
      "index": 18,
      "title": "Using crash hoare logic for certifying the fscq file system",
      "abstract": "",
      "year": "2015",
      "venue": "Symposium on Operating Systems Principles",
      "authors": "Haogang Chen, Daniel Ziegler, Tej Chajed, Adam Chlipala, M. Frans Kaashoek, and Nickolai Zeldovich"
    },
    {
      "index": 19,
      "title": "Orderless and Eventually Durable File Systems",
      "abstract": "",
      "year": "2015",
      "venue": "",
      "authors": "Vijay Chidambaram"
    },
    {
      "index": 20,
      "title": "Consistency Without Ordering",
      "abstract": "",
      "year": "2012",
      "venue": "Conference on File and Storage Technologies",
      "authors": "Vijay Chidambaram, Tushar Sharma, Andrea C. Arpaci-Dusseau, and Remzi H. Arpaci-Dusseau"
    },
    {
      "index": 21,
      "title": "Benchmarking cloud serving systems with ycsb",
      "abstract": "",
      "year": "2010",
      "venue": "ACM Symposium on Cloud Computing",
      "authors": "Brian F. Cooper, Adam Silberstein, Erwin Tam, Raghu Ramakrishnan, and Russell Sears"
    },
    {
      "index": 22,
      "title": "Soft updates made simple and fast on non-volatile memory",
      "abstract": "",
      "year": "2017",
      "venue": "USENIX Annual Technical Conference",
      "authors": "Mingkai Dong and Haibo Chen"
    },
    {
      "index": 23,
      "title": "System software for persistent memory",
      "abstract": "",
      "year": "2014",
      "venue": "European Conference on Computer Systems",
      "authors": "Subramanya R. Dulloor, Sanjay Kumar, Anil Keshavamurthy, Philip Lantz, Dheeraj Reddy, Rajesh Sankaran, and Jeff Jackson"
    },
    {
      "index": 24,
      "title": "Generalized file system dependencies",
      "abstract": "",
      "year": "2007",
      "venue": "ACM SIGOPS Symposium on Operating Systems Principles",
      "authors": "Christopher Frost, Mike Mammarella, Eddie Kohler, Andrew de los Reyes, Shant Hovsepian, Andrew Matsuoka, and Lei Zhang"
    },
    {
      "index": 25,
      "title": "Metadata update performance in file systems",
      "abstract": "",
      "year": "1994",
      "venue": "USENIX Symposium on Operating Systems Design and Implementation",
      "authors": "Gregory R. Ganger and Yale N. Patt"
    },
    {
      "index": 26,
      "title": "Rust for Rustaceans",
      "abstract": "",
      "year": "2022",
      "venue": "No Starch Press",
      "authors": "Jon Gjenset"
    },
    {
      "index": 27,
      "title": "Reimplementing the cedar file system using logging and group commit",
      "abstract": "",
      "year": "1987",
      "venue": "ACM Symposium on Operating System Principles",
      "authors": "Robert B. Hagmann"
    },
    {
      "index": 28,
      "title": "Storage systems are distributed systems (so verify them that way!)",
      "abstract": "",
      "year": "2020",
      "venue": "USENIX Conference on Operating Systems Design and Implementation",
      "authors": "Travis Hance, Andrea Lattuada, Chris Hawblitzel, Jon Howell, Rob Johnson, and Bryan Parno"
    },
    {
      "index": 29,
      "title": "Ironfleet: Proving practical distributed systems correct",
      "abstract": "",
      "year": "2015",
      "venue": "ACM Symposium on Operating Systems Principles",
      "authors": "Chris Hawblitzel, Jon Howell, Manos Kapritsos, Jay Lorch, Bryan Parno, Justine Stephenson, Srinath Setty, and Brian Zill"
    },
    {
      "index": 30,
      "title": "File system design for an NFS file server appliance",
      "abstract": "",
      "year": "1994",
      "venue": "USENIX Winter Technical Conference",
      "authors": "Dave Hitz, James Lau, and Michael A. Malcolm"
    },
    {
      "index": 31,
      "title": "Corundum: Statically-enforced persistent memory safety",
      "abstract": "",
      "year": "2021",
      "venue": "ACM International Conference on Architectural Support for Programming Languages and Operating Systems",
      "authors": "Morteza Hoseinzadeh and Steven Swanson"
    },
    {
      "index": 32,
      "title": "Software Abstractions",
      "abstract": "",
      "year": "2016",
      "venue": "The MIT Press",
      "authors": "Daniel Jackson"
    },
    {
      "index": 33,
      "title": "Winefs: A hugepage-aware file system for persistent memory that ages gracefully",
      "abstract": "",
      "year": "2021",
      "venue": "ACM SIGOPS Symposium on Operating Systems Principles",
      "authors": "Rohan Kadekodi, Saurabh Kadekodi, Soujanya Ponnapalli, Harshad Shirwadkar, Gregory R. Ganger, Aasheesh Kolli, and Vijay Chidambaram"
    },
    {
      "index": 34,
      "title": "SplitFS: Reducing Software Overhead in File Systems for Persistent Memory",
      "abstract": "",
      "year": "2019",
      "venue": "ACM Symposium on Operating Systems Principles",
      "authors": "Rohan Kadekodi, Se Kwon Lee, Sanidhya Kashyap, Taesoo Kim, Aasheesh Kolli, and Vijay Chidambaram",
      "orig_title": "Splitfs: Reducing software overhead in file systems for persistent memory",
      "paper_id": "1909.10123v1"
    },
    {
      "index": 35,
      "title": "Vinter: Automatic Non-Volatile memory crash consistency testing for full systems",
      "abstract": "",
      "year": "2022",
      "venue": "USENIX Annual Technical Conference",
      "authors": "Samuel Kalbfleisch, Lukas Werling, and Frank Bellosa"
    },
    {
      "index": 36,
      "title": "Finding semantic bugs in file systems with an extensible fuzzing framework",
      "abstract": "",
      "year": "2019",
      "venue": "ACM Symposium on Operating Systems Principles",
      "authors": "Seulbae Kim, Meng Xu, Sanidhya Kashyap, Jungyeon Yoon, Wen Xu, and Taesoo Kim"
    },
    {
      "index": 37,
      "title": "The Rust Programming Language",
      "abstract": "",
      "year": "2018",
      "venue": "No Starch Press",
      "authors": "Steve Klabnik and Carol Nichols"
    },
    {
      "index": 38,
      "title": "Strata: A cross media file system",
      "abstract": "",
      "year": "2017",
      "venue": "Symposium on Operating Systems Principles",
      "authors": "Youngjin Kwon, Henrique Fingler, Tyler Hunt, Simon Peter, Emmett Witchel, and Thomas Anderson"
    },
    {
      "index": 39,
      "title": "Bug #317781: Ext4 Data Loss",
      "abstract": "",
      "year": "",
      "venue": "",
      "authors": "Ubuntu Bugs LaunchPad"
    },
    {
      "index": 40,
      "title": "Chipmunk: Investigating crash-consistency in persistent-memory file systems",
      "abstract": "",
      "year": "2023",
      "venue": "European Conference on Computer Systems",
      "authors": "Hayley LeBlanc, Shankara Pailoor, Om Saran K R E, Isil Dillig, James Bornholt, and Vijay Chidambaram"
    },
    {
      "index": 41,
      "title": "Physical Integrity in a Large Segmented Database",
      "abstract": "",
      "year": "1977",
      "venue": "ACM Transactions on Databases",
      "authors": "R. Lorie"
    },
    {
      "index": 42,
      "title": "Soft updates: A technique for eliminating most synchronous writes in the fast filesystem",
      "abstract": "",
      "year": "1999",
      "venue": "USENIX Annual Technical Conference",
      "authors": "Marshall Kirk McKusick and Gregory R. Ganger"
    },
    {
      "index": 43,
      "title": "The Design and Implementation of the FreeBSD Operating System",
      "abstract": "",
      "year": "2014",
      "venue": "Addison-Wesley Professional",
      "authors": "Marshall Kirk McKusick, George Neville-Neil, and Robert N.M. Watson"
    },
    {
      "index": 44,
      "title": "High Velocity Kernel File Systems with Bento",
      "abstract": "",
      "year": "2021",
      "venue": "USENIX Conference on File and Storage Technologies",
      "authors": "Samantha Miller, Kaiyuan Zhang, Mengqi Chen, Ryan Jennings, Ang Chen, Danyang Zhuo, and Thomas Anderson",
      "orig_title": "High velocity kernel file systems with bento",
      "paper_id": "2005.09723v3"
    },
    {
      "index": 45,
      "title": "CrashMonkey and ACE: Systematically testing file-system crash consistency",
      "abstract": "",
      "year": "2019",
      "venue": "ACM Transactions on Storage",
      "authors": "Jayashree Mohan, Ashlie Martinez, Soujanya Ponnapalli, Pandian Raju, and Vijay Chidambaram"
    },
    {
      "index": 46,
      "title": "AGAMOTTO: How persistent is your persistent memory application?",
      "abstract": "",
      "year": "2020",
      "venue": "USENIX Symposium on Operating Systems Design and Implementation",
      "authors": "Ian Neal, Ben Reeves, Ben Stoler, Andrew Quinn, Youngjin Kwon, Simon Peter, and Baris Kasikci"
    },
    {
      "index": 47,
      "title": "The cedar file system",
      "abstract": "",
      "year": "1988",
      "venue": "Communications of the ACM",
      "authors": "Roger M. Needham, David K. Gifford, and Mike Schroeder"
    },
    {
      "index": 48,
      "title": "How amazon web services uses formal methods",
      "abstract": "",
      "year": "2015",
      "venue": "Communications of the ACM",
      "authors": "Chris Newcombe, Tim Rath, Fan Zhang, Bogdan Munteanu, Marc Brooker, and Michael Deardeuff"
    },
    {
      "index": 49,
      "title": "All file systems are not created equal: On the complexity of crafting crash-consistent applications",
      "abstract": "",
      "year": "2014",
      "venue": "USENIX Symposium on Operating Systems Design and Implementation",
      "authors": "Thanumalayan Sankaranarayana Pillai, Vijay Chidambaram, Ramnatthan Alagappan, Samer Al-Kiswany, Andrea C. Arpaci-Dusseau, and Remzi H. Arpaci-Dusseau"
    },
    {
      "index": 50,
      "title": "Crash consistency",
      "abstract": "",
      "year": "2015",
      "venue": "Communications of the ACM",
      "authors": "Thanumalayan Sankaranarayana Pillai, Vijay Chidambaram, Ramnatthan Alagappan, Samer Al-Kiswany, Andrea C. Arpaci-Dusseau, and Remzi H. Arpaci-Dusseau"
    },
    {
      "index": 51,
      "title": "Persistent memory programming",
      "abstract": "",
      "year": "2017",
      "venue": "login:",
      "authors": "Andy Rudoff"
    },
    {
      "index": 52,
      "title": "Push-Button verification of file systems via crash refinement",
      "abstract": "",
      "year": "2016",
      "venue": "USENIX Symposium on Operating Systems Design and Implementation",
      "authors": "Helgi Sigurbjarnarson, James Bornholt, Emina Torlak, and Xi Wang"
    },
    {
      "index": 53,
      "title": "Typestate: A programming language concept for enhancing software reliability",
      "abstract": "",
      "year": "1986",
      "venue": "IEEE Transactions on Software Engineering",
      "authors": "Robert E. Strom and Shaula Yemini"
    },
    {
      "index": 54,
      "title": "Synthesis-Aided Crash Consistency for Storage Systems",
      "abstract": "",
      "year": "2023",
      "venue": "European Conference on Object-Oriented Programming",
      "authors": "Jacob Van Geffen, Xi Wang, Emina Torlak, and James Bornholt"
    },
    {
      "index": 55,
      "title": "Finding and fixing performance pathologies in persistent memory software stacks",
      "abstract": "",
      "year": "2019",
      "venue": "International Conference on Architectural Support for Programming Languages and Operating Systems",
      "authors": "Jian Xu, Juno Kim, Amir Saman Memaripour, and Steven Swanson"
    },
    {
      "index": 56,
      "title": "NOVA: A log-structured file system for hybrid Volatile/Non-volatile main memories",
      "abstract": "",
      "year": "2016",
      "venue": "USENIX Conference on File and Storage Technologies",
      "authors": "Jian Xu and Steven Swanson"
    },
    {
      "index": 57,
      "title": "An Empirical Guide to the Behavior and Use of Scalable Persistent Memory",
      "abstract": "",
      "year": "2020",
      "venue": "USENIX Conference on File and Storage Technologies",
      "authors": "Jian Yang, Juno Kim, Morteza Hoseinzadeh, Joseph Izraelevitz, and Steven Swanson",
      "orig_title": "An empirical guide to the behavior and use of scalable persistent memory",
      "paper_id": "1908.03583v1"
    },
    {
      "index": 58,
      "title": "Using model checking to find serious file system errors",
      "abstract": "",
      "year": "2004",
      "venue": "Symposium on Operating Systems Design and Implementation",
      "authors": "Junfeng Yang, Paul Twohey, Dawson Engler, and Madanlal Musuvathi"
    },
    {
      "index": 59,
      "title": "Enabling high-performance and secure userspace nvm file systems with the trio architecture",
      "abstract": "",
      "year": "2023",
      "venue": "Symposium on Operating Systems Principles",
      "authors": "Diyu Zhou, Vojtech Aschenbrenner, Tao Lyu, Jian Zhang, Sudarsun Kannan, and Sanidhya Kashyap"
    }
  ]
}