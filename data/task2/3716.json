{
  "messages": [
    {
      "role": "system",
      "content": "You are a professional academic citation prediction expert. Your task is to predict the most likely citations for [ref] markers in academic paper sections based on the paper content and retrieved relevant papers.\n\nRETRIEVER INTERFACE:\n- Input: paper title + abstract + section text with [ref] markers\n- Output: top {top_r} retrieved papers with title and abstract\n- Format: List of dictionaries with 'title' and 'abstract' fields\n\nCRITICAL FORMAT REQUIREMENT: You must respond with ONLY valid JSON. Do not include any explanatory text, markdown formatting, or other content outside the JSON structure.\n\nTASK DESCRIPTION:\n- Input: Paper section text with [ref] markers + retrieved relevant papers\n- Output: top 40 predicted reference titles for each [ref] marker with reasoning\n- Format: JSON object with \"citations\" array containing objects with \"ref_index\", \"titles\", and \"reasoning\" fields\n\nREQUIREMENTS:\n1. Analyze the context around each [ref] marker to understand what reference is needed\n2. Consider the retrieved papers as potential references (when available)\n3. Consider the surrounding text, research area, and topic\n4. Generate realistic and relevant reference titles that would fit the context\n5. Provide detailed reasoning for each prediction to prevent hallucination\n6. Output format: JSON object with \"citations\" array\n7. Generate exactly 40 most relevant reference titles for each [ref]\n8. Ensure titles are realistic and appropriate for the research area\n9. Include reasoning that explains why each title is relevant to the specific [ref] context\n10. Use proper JSON escaping for special characters (escape quotes with \\\")\n11. Ensure all strings are properly quoted and escaped\n\nEXAMPLE:\nInput:\n\"Federated Learning aims to train models in massively distributed networks [ref]38 at a large scale [ref]5, over multiple sources of heterogeneous data [ref]30.\"\n\nRetrieved papers (top {top_r}):\n1. Title: Communication-efficient learning of deep networks from decentralized data\n   Abstract: We report on a series of experiments with federated learning systems for decentralized data training.\n\n2. Title: Federated Learning: Challenges, Methods, and Future Directions\n   Abstract: A comprehensive survey of federated learning approaches and challenges in distributed settings.\n\nOutput:\n{\n  \"citations\": [\n    {\n      \"ref_index\": 38,\n      \"titles\": [\n        \"Communication-efficient learning of deep networks from decentralized data\",\n        \"Federated Learning: Challenges, Methods, and Future Directions\",\n        \"Federated optimization in heterogeneous networks\",\n        \"Towards federated learning at scale: System design\",\n        \"A performance evaluation of federated learning algorithms\",\n        \"Distributed machine learning: A survey\",\n        \"Communication protocols for distributed learning\",\n        \"Scalable federated learning systems\",\n        \"Efficient distributed training algorithms\",\n        \"Large-scale distributed learning frameworks\"\n      ],\n      \"reasoning\": \"This [ref]38 appears in the context of 'massively distributed networks' for federated learning, so it likely refers to foundational papers on federated learning systems, distributed training, and communication-efficient methods in distributed networks.\"\n    },\n    {\n      \"ref_index\": 5,\n      \"titles\": [\n        \"Bagging predictors\",\n        \"Ensemble methods in machine learning\",\n        \"Random forests for classification\",\n        \"Bootstrap methods and their application\",\n        \"Combining multiple classifiers\",\n        \"Large-scale machine learning systems\",\n        \"Distributed ensemble methods\",\n        \"Scalable classification algorithms\",\n        \"Massive data processing techniques\",\n        \"High-performance machine learning frameworks\"\n      ],\n      \"reasoning\": \"This [ref]5 appears in the context of 'at a large scale', suggesting it refers to papers on scaling machine learning methods, ensemble techniques, or methods that can handle large-scale data and distributed settings.\"\n    },\n    {\n      \"ref_index\": 30,\n      \"titles\": [\n        \"Learning fair representations\",\n        \"Fair machine learning: A survey\",\n        \"Bias in machine learning systems\",\n        \"Addressing fairness in AI systems\",\n        \"Fair representation learning\",\n        \"Heterogeneous data handling methods\",\n        \"Multi-source learning algorithms\",\n        \"Cross-domain representation learning\",\n        \"Fair learning from diverse data\",\n        \"Bias mitigation in heterogeneous datasets\"\n      ],\n      \"reasoning\": \"This [ref]30 appears in the context of 'heterogeneous data' and 'fair representation learning', indicating it likely refers to papers on heterogenous data handling, bias mitigation, and learning representations that are fair across different data distributions.\"\n    }\n  ]\n}\n\nCRITICAL: Return ONLY the JSON object. Do not include any text before or after the JSON. Do not use markdown formatting. Ensure all quotes and special characters are properly escaped.\n\nIMPORTANT NOTES ON REASONING:\n- The reasoning field is crucial for preventing hallucination\n- Each reasoning should be specific to the context around the [ref] marker\n- Explain the connection between the predicted titles and the research topic\n- This helps validate that predictions are grounded in the actual content\n- Reasoning should be concise but informative (2-3 sentences)\n- Consider retrieved papers when available to improve prediction accuracy"
    },
    {
      "role": "user",
      "content": "Paper Title: On ğ‘‘-stable locally checkable problems parameterized by mim-width\n\nPaper Abstract: \n\nPaper Section Text:\nIn this section we give a more straightforward algorithm to solve dğ‘‘d-stable locally checkable problems with size and connectivity constraints.\nIts complexity is slightly better than the one obtained with the DN logic formulation.\nTo be precise, we will show the following theorem:\n\nSee 1.2 We first define some necessary terms and notation.\nLet dğ‘‘d be a positive integer.\nWe define an equivalence relation =dsubscriptğ‘‘=_{d} on the natural numbers, where two non-negative integers iğ‘–i and jğ‘—j are equivalent if and only if minâ¡(d,i)=minâ¡(d,j)ğ‘‘ğ‘–ğ‘‘ğ‘—\\min(d,i)=\\min(d,j).\nFor a binary decomposition tree (T,Î´)ğ‘‡ğ›¿(T,\\delta) of a graph GğºG and a node vâˆˆVâ€‹(T)ğ‘£ğ‘‰ğ‘‡v\\in V(T),\nwe make use of the equivalence relation â‰¡dvsuperscriptsubscriptğ‘‘ğ‘£\\equiv_{d}^{v} presented inÂ .\nIt is defined on subsets of Tvsubscriptğ‘‡ğ‘£T_{v} where two subsets S,Sâ€²âŠ†Tvğ‘†superscriptğ‘†â€²subscriptğ‘‡ğ‘£S,S^{\\prime}\\subseteq T_{v} are equivalent if and only if for any yâˆˆTvÂ¯ğ‘¦subscriptğ‘‡Â¯ğ‘£y\\in T_{\\overline{v}} we have |Nâ€‹(y)âˆ©S|=d|Nâ€‹(y)âˆ©Sâ€²|subscriptğ‘‘ğ‘ğ‘¦ğ‘†ğ‘ğ‘¦superscriptğ‘†â€²|N(y)\\cap S|=_{d}|N(y)\\cap S^{\\prime}|.\nIntuitively, from a perspective of locally checkable problems, we could say that two subsets of Tvsubscriptğ‘‡ğ‘£T_{v} are equivalent if replacing one for the other would not influence the output of any dğ‘‘d-stable check function when applied to any vertex yğ‘¦y in TvÂ¯subscriptğ‘‡Â¯ğ‘£T_{\\overline{v}}.\nThe idea behind this is that we do not want to save all partial solutions in a dynamic programming algorithm, and (roughly speaking) it is enough to save one representative for each equivalence class.\nOne of the key ideas when working with this equivalence class is then to give an upper bound for the number of equivalence classes which then leads to an upper bound of the number of partial solutions that we have to save.\nSuch an upper bound in terms of the mim-width of the decomposition of the graph was given in , where it was shown that the number of equivalence classes of â‰¡dvsuperscriptsubscriptğ‘‘ğ‘£\\equiv_{d}^{v} is at most Oâ€‹(ndâ‹…mâ€‹iâ€‹mâ€‹wâ€‹(G))ğ‘‚superscriptğ‘›â‹…ğ‘‘ğ‘šğ‘–ğ‘šğ‘¤ğºO(n^{d\\cdot mimw(G)}). Based on â‰¡dvsuperscriptsubscriptğ‘‘ğ‘£\\equiv_{d}^{v}, we\ndefine the equivalence relation â‰¡d,qvsuperscriptsubscriptğ‘‘ğ‘ğ‘£\\equiv_{d,q}^{v} on qğ‘q-tuples of subsets of Tvsubscriptğ‘‡ğ‘£T_{v}, where two qğ‘q-tuples X,Xâ€²âˆˆ(ğ’«â€‹(Tv))qğ‘‹superscriptğ‘‹â€²superscriptğ’«subscriptğ‘‡ğ‘£ğ‘X,X^{\\prime}\\in(\\mathcal{P}(T_{v}))^{q} are equivalent if and only if they are entry-wise equivalent according to â‰¡dvsuperscriptsubscriptğ‘‘ğ‘£\\equiv_{d}^{v}.\nAnalogously, we define the equivalence relations â‰¡dvÂ¯superscriptsubscriptğ‘‘Â¯ğ‘£\\equiv_{d}^{\\overline{v}} and â‰¡d,qvÂ¯superscriptsubscriptğ‘‘ğ‘Â¯ğ‘£\\equiv_{d,q}^{\\overline{v}} where subsets S,Sâ€²ğ‘†superscriptğ‘†â€²S,S^{\\prime} of TvÂ¯subscriptğ‘‡Â¯ğ‘£T_{\\overline{v}} are equivalent if for every vertex wğ‘¤w in Tvsubscriptğ‘‡ğ‘£T_{v} we have |Nâ€‹(w)âˆ©S|=d|Nâ€‹(w)âˆ©Sâ€²|subscriptğ‘‘ğ‘ğ‘¤ğ‘†ğ‘ğ‘¤superscriptğ‘†â€²|N(w)\\cap S|=_{d}|N(w)\\cap S^{\\prime}|, and analogously for tuples in (ğ’«â€‹(TvÂ¯))qsuperscriptğ’«subscriptğ‘‡Â¯ğ‘£ğ‘(\\mathcal{P}(T_{\\overline{v}}))^{q}.\nWe will mainly use these relations when referring to partitions of Tvsubscriptğ‘‡ğ‘£T_{v} and not arbitrary tuples of subsets. For an equivalence relation â‰¡\\equiv on a set Sğ‘†S and XâˆˆSğ‘‹ğ‘†X\\in S, we denote by [X]â‰¡superscriptdelimited-[]ğ‘‹[X]^{\\equiv} the equivalence class which consists of all elements Xâ€²âˆˆSsuperscriptğ‘‹â€²ğ‘†X^{\\prime}\\in S such that Xâ€²â‰¡Xsuperscriptğ‘‹â€²ğ‘‹X^{\\prime}\\equiv X.\nWhen the equivalence relation is clear from context, we will drop the superscript and only write [X]delimited-[]ğ‘‹[X].\nWe denote by â„›dvsuperscriptsubscriptâ„›ğ‘‘ğ‘£\\mathcal{R}_{d}^{v} and â„›d,qvsuperscriptsubscriptâ„›ğ‘‘ğ‘ğ‘£\\mathcal{R}_{d,q}^{v} the set of all equivalence classes of the relations â‰¡dvsuperscriptsubscriptğ‘‘ğ‘£\\equiv_{d}^{v} and â‰¡d,qvsuperscriptsubscriptğ‘‘ğ‘ğ‘£\\equiv_{d,q}^{v}, respectively, and analogously for vÂ¯Â¯ğ‘£\\overline{v}.\nIf Râˆˆâ„›d,qvğ‘…superscriptsubscriptâ„›ğ‘‘ğ‘ğ‘£R\\in\\mathcal{R}_{d,q}^{v} and Xâˆˆ(ğ’«â€‹(Tv))qğ‘‹superscriptğ’«subscriptğ‘‡ğ‘£ğ‘X\\in(\\mathcal{P}(T_{v}))^{q} we write Xâ‰¡d,qvRsuperscriptsubscriptğ‘‘ğ‘ğ‘£ğ‘‹ğ‘…X\\equiv_{d,q}^{v}R if Xğ‘‹X is contained in the equivalence class Rğ‘…R and say that Xğ‘‹X is a representative of Rğ‘…R (and analogously for vÂ¯Â¯ğ‘£\\overline{v}).\nIf Râˆˆâ„›dvğ‘…superscriptsubscriptâ„›ğ‘‘ğ‘£R\\in\\mathcal{R}_{d}^{v} and wâˆˆTvÂ¯ğ‘¤subscriptğ‘‡Â¯ğ‘£w\\in T_{\\overline{v}} we define |Nâ€‹(w)âˆ©R|ğ‘ğ‘¤ğ‘…|N(w)\\cap R| to be the unique number iâˆˆ{0,â€¦,d}ğ‘–0â€¦ğ‘‘i\\in\\left\\{0,\\ldots,d\\right\\} such that i=d|Nâ€‹(w)âˆ©S|subscriptğ‘‘ğ‘–ğ‘ğ‘¤ğ‘†i=_{d}|N(w)\\cap S| for some SâŠ†Tvğ‘†subscriptğ‘‡ğ‘£S\\subseteq T_{v} with Sâ‰¡dvRsuperscriptsubscriptğ‘‘ğ‘£ğ‘†ğ‘…S\\equiv_{d}^{v}R.\nThis notion is well-defined by the definition of â‰¡dvsuperscriptsubscriptğ‘‘ğ‘£\\equiv_{d}^{v}.\nWe say that wğ‘¤w is adjacent to Rğ‘…R if |Nâ€‹(w)âˆ©R|â‰¥1ğ‘ğ‘¤ğ‘…1|N(w)\\cap R|\\geq 1 and we say that a set SâŠ†TvÂ¯ğ‘†subscriptğ‘‡Â¯ğ‘£S\\subseteq T_{\\overline{v}} is adjacent to Rğ‘…R if it contains a vertex which is adjacent to Rğ‘…R.\nIf CâŠ†[q]ğ¶delimited-[]ğ‘C\\subseteq[q] and Xâˆˆ(ğ’«â€‹(Tv))qğ‘‹superscriptğ’«subscriptğ‘‡ğ‘£ğ‘X\\in(\\mathcal{P}(T_{v}))^{q}, we denote by XCsubscriptğ‘‹ğ¶X_{C} the set â‹ƒiâˆˆCXiâŠ†Tvsubscriptğ‘–ğ¶subscriptğ‘‹ğ‘–subscriptğ‘‡ğ‘£\\bigcup_{i\\in C}X_{i}\\subseteq T_{v} and we also define the equivalence class [X]Csubscriptdelimited-[]ğ‘‹ğ¶[X]_{C} of the relation â‰¡dvsuperscriptsubscriptğ‘‘ğ‘£\\equiv_{d}^{v} by setting [X]C=[XC]subscriptdelimited-[]ğ‘‹ğ¶delimited-[]subscriptğ‘‹ğ¶[X]_{C}=[X_{C}].\nWe do everything analogously for TvÂ¯subscriptğ‘‡Â¯ğ‘£T_{\\overline{v}}.\nWe define snecdâ€‹(T)=maxvâˆˆVâ€‹(T)â¡(maxâ¡{|â„›dv|,|â„›dvÂ¯|})subscriptsnecğ‘‘ğ‘‡subscriptğ‘£ğ‘‰ğ‘‡superscriptsubscriptâ„›ğ‘‘ğ‘£superscriptsubscriptâ„›ğ‘‘Â¯ğ‘£\\textrm{snec}_{d}(T)=\\max_{v\\in V(T)}(\\max\\{|\\mathcal{R}_{d}^{v}|,|\\mathcal{R}_{d}^{\\overline{v}}|\\}) and snecd,qâ€‹(T)=maxvâˆˆVâ€‹(T)â¡(maxâ¡{|â„›d,qv|,|â„›d,qvÂ¯|})subscriptsnecğ‘‘ğ‘ğ‘‡subscriptğ‘£ğ‘‰ğ‘‡superscriptsubscriptâ„›ğ‘‘ğ‘ğ‘£superscriptsubscriptâ„›ğ‘‘ğ‘Â¯ğ‘£\\textrm{snec}_{d,q}(T)=\\max_{v\\in V(T)}(\\max\\{|\\mathcal{R}_{d,q}^{v}|,|\\mathcal{R}_{d,q}^{\\overline{v}}|\\}). It was shown inÂ [22, Lemma 1] that for a node vğ‘£v of Tğ‘‡T we can compute a list which contains exactly one representative of each equivalence class of â‰¡dvsuperscriptsubscriptğ‘‘ğ‘£\\equiv_{d}^{v}, in time Oâ€‹(snecdâ€‹(T)â€‹logâ¡(snecdâ€‹(T))â€‹|Vâ€‹(G)|2)ğ‘‚subscriptsnecğ‘‘ğ‘‡subscriptsnecğ‘‘ğ‘‡superscriptğ‘‰ğº2O(\\textrm{snec}_{d}(T)\\log(\\textrm{snec}_{d}(T))|V(G)|^{2}).\nThe same applies to â‰¡dvÂ¯superscriptsubscriptğ‘‘Â¯ğ‘£\\equiv_{d}^{\\overline{v}}.\nByÂ [10, Lemma 2], snecdâ€‹(T)â‰¤ndâ‹…mâ€‹iâ€‹mâ€‹wâ€‹(T,Î´)subscriptsnecğ‘‘ğ‘‡superscriptğ‘›â‹…ğ‘‘ğ‘šğ‘–ğ‘šğ‘¤ğ‘‡ğ›¿\\textrm{snec}_{d}(T)\\leq n^{d\\cdot mimw(T,\\delta)}.\nSince the equivalence classes of â‰¡d,qvsuperscriptsubscriptğ‘‘ğ‘ğ‘£\\equiv_{d,q}^{v} and â‰¡d,qvÂ¯superscriptsubscriptğ‘‘ğ‘Â¯ğ‘£\\equiv_{d,q}^{\\overline{v}} are qğ‘q-tuples of equivalence classes of â‰¡dvsuperscriptsubscriptğ‘‘ğ‘£\\equiv_{d}^{v} and â‰¡dvÂ¯superscriptsubscriptğ‘‘Â¯ğ‘£\\equiv_{d}^{\\overline{v}}, respectively, their representatives are simply the qğ‘q-tuples of the representatives of â‰¡dvsuperscriptsubscriptğ‘‘ğ‘£\\equiv_{d}^{v} and â‰¡dvÂ¯superscriptsubscriptğ‘‘Â¯ğ‘£\\equiv_{d}^{\\overline{v}}, respectively.\nThus, we can also efficiently compute a list of representatives and snecd,qâ€‹(T)â‰¤nqâ‹…dâ‹…mâ€‹iâ€‹mâ€‹wâ€‹(T,Î´)subscriptsnecğ‘‘ğ‘ğ‘‡superscriptğ‘›â‹…ğ‘ğ‘‘ğ‘šğ‘–ğ‘šğ‘¤ğ‘‡ğ›¿\\textrm{snec}_{d,q}(T)\\leq n^{q\\cdot d\\cdot mimw(T,\\delta)}. The next lemma shows that it is possible to solve, in polynomial time for graphs of bounded mim-width with a given suitable binary decomposition tree, a locally checkable problem with a dğ‘‘d-stable check function, a dğ‘‘d-stable weight function, a set of positive connectivity constraints ğ’âŠ†ğ’«â€‹([q])ğ’ğ’«delimited-[]ğ‘\\mathcal{C}\\subseteq\\mathcal{P}([q]) and a size constraint ğ’¦ğ’¦\\mathcal{K} with |ğ’¦|=1ğ’¦1|\\mathcal{K}|=1.\nWe will later explain how this result can be easily extended to a set ğ’¦ğ’¦\\mathcal{K} of several size constraints and to negative connectivity constraints.\nFor the complexity analysis, we will use the fact that dğ‘‘d and qğ‘q are constants and that |ğ’|â‰¤2qğ’superscript2ğ‘|\\mathcal{C}|\\leq 2^{q} (and hence is bounded by a constant). Let d,qğ‘‘ğ‘d,q be integers, with qâ‰¥2ğ‘2q\\geq 2.\nConsider a dğ‘‘d-stable locally checkable problem Î Î \\Pi with qğ‘q colors, a set ğ’¦ğ’¦\\mathcal{K} containing only one size constraint Kğ¾K, and a set of positive connectivity constraints ğ’ğ’\\mathcal{C}.\nThen, for an input graph GğºG with an associated binary decomposition tree (T,Î´)ğ‘‡ğ›¿(T,\\delta), we can solve Î Î \\Pi in\nOâ€‹(n2â€‹qâ‹…snecd,qâ€‹(T)6â€‹|ğ’|+6â‹…(n2+snecd,qâ€‹(T)Ï‰âˆ’1))ğ‘‚â‹…â‹…superscriptğ‘›2ğ‘subscriptsnecğ‘‘ğ‘superscriptğ‘‡6ğ’6superscriptğ‘›2subscriptsnecğ‘‘ğ‘superscriptğ‘‡ğœ”1O\\left(n^{2q}\\cdot\\textrm{snec}_{d,q}(T)^{6|\\mathcal{C}|+6}\\cdot\\left(n^{2}+\\textrm{snec}_{d,q}(T)^{\\omega-1}\\right)\\right)\ntime,\nwhere n=|Vâ€‹(G)|ğ‘›ğ‘‰ğºn=|V(G)| and Ï‰ğœ”\\omega is the matrix multiplication exponent (Ï‰<2.4ğœ”2.4\\omega<2.4,Â ). This proof closely follows the ones given inÂ  andÂ [ref]15.\nOur focus will be on highlighting that the dğ‘‘d-stability of the check function is enough to guarantee the correctness of the output, and how the weight function and the restriction on the size of color classes can be implemented. First of all, notice that finding a coloring cğ‘c of GğºG with qğ‘q colors {a1,â€¦,aq}subscriptğ‘1â€¦subscriptğ‘ğ‘\\{a_{1},\\ldots,a_{q}\\} is equivalent to finding a qğ‘q-partition (X1,â€¦,Xq)subscriptğ‘‹1â€¦subscriptğ‘‹ğ‘(X_{1},\\ldots,X_{q}) of Vâ€‹(G)ğ‘‰ğºV(G), where Xj=câˆ’1â€‹(aj)subscriptğ‘‹ğ‘—superscriptğ‘1subscriptğ‘ğ‘—X_{j}=c^{-1}(a_{j}) for all jâˆˆ[q]ğ‘—delimited-[]ğ‘j\\in[q].\nWe will therefore show how to compute a qğ‘q-partition Xâˆˆpartqâ€‹(Vâ€‹(G))ğ‘‹subscriptpartğ‘ğ‘‰ğºX\\in\\textrm{part}_{q}(V(G)) such that\ncâ€‹hâ€‹eâ€‹câ€‹kâ€‹(v,a,|Nâ€‹(v)âˆ©X1|,â€¦,|Nâ€‹(v)âˆ©Xq|)=Trueğ‘â„ğ‘’ğ‘ğ‘˜ğ‘£ğ‘ğ‘ğ‘£subscriptğ‘‹1â€¦ğ‘ğ‘£subscriptğ‘‹ğ‘Truecheck(v,a,|N(v)\\cap X_{1}|,\\ldots,|N(v)\\cap X_{q}|)=\\textsc{True} for all vâˆˆVâ€‹(G)ğ‘£ğ‘‰ğºv\\in V(G) and aâˆˆColorsğ‘Colorsa\\in\\textsc{Colors},\n|X|=Kğ‘‹ğ¾|X|=K and\nGâ€‹[XC]ğºdelimited-[]subscriptğ‘‹ğ¶G[X_{C}] is connected for all Câˆˆğ’ğ¶ğ’C\\in\\mathcal{C}.\nWe will assume that GğºG does not contain isolated vertices (if it did, we could solve the locally checkable problem independently in each connected component). For every vâˆˆVâ€‹(T)ğ‘£ğ‘‰ğ‘‡v\\in V(T), Xâˆˆpartqâ€‹(Tv)ğ‘‹subscriptpartğ‘subscriptğ‘‡ğ‘£X\\in\\textrm{part}_{q}(T_{v}) and Râ€²âˆˆâ„›d,qvÂ¯superscriptğ‘…â€²superscriptsubscriptâ„›ğ‘‘ğ‘Â¯ğ‘£R^{\\prime}\\in\\mathcal{R}_{d,q}^{\\overline{v}} and some Yâˆˆpartqâ€‹(TvÂ¯)ğ‘Œsubscriptpartğ‘subscriptğ‘‡Â¯ğ‘£Y\\in\\textrm{part}_{q}(T_{\\overline{v}}) with Yâ‰¡d,qvÂ¯Râ€²superscriptsubscriptğ‘‘ğ‘Â¯ğ‘£ğ‘Œsuperscriptğ‘…â€²Y\\equiv_{d,q}^{\\overline{v}}R^{\\prime} we define the weight of Xğ‘‹X when complemented with Yğ‘ŒY, wâ€‹(X,Y)wğ‘‹ğ‘Œ\\textsc{w}(X,Y), as We define wâ€‹(X,[Y])=wâ€‹(X,Y)wğ‘‹delimited-[]ğ‘Œwğ‘‹ğ‘Œ\\textsc{w}(X,[Y])=\\textsc{w}(X,Y).\nIt follows from the dğ‘‘d-stability of w and the definition of the equivalence relation â‰¡d,qvÂ¯superscriptsubscriptğ‘‘ğ‘Â¯ğ‘£\\equiv_{d,q}^{\\overline{v}} that this notion is well-defined. We say that a tuple (X,Y)âˆˆpartqâ€‹(Tv)Ã—partqâ€‹(TvÂ¯)ğ‘‹ğ‘Œsubscriptpartğ‘subscriptğ‘‡ğ‘£subscriptpartğ‘subscriptğ‘‡Â¯ğ‘£(X,Y)\\in\\textrm{part}_{q}(T_{v})\\times\\textrm{part}_{q}(T_{\\overline{v}}) is Tvsubscriptğ‘‡ğ‘£T_{v}-valid if for any vertex wâˆˆTvğ‘¤subscriptğ‘‡ğ‘£w\\in T_{v} we have câ€‹hâ€‹eâ€‹câ€‹kâ€‹(w,jw,|Nâ€‹(w)âˆ©(X1âˆªY1)|,â€¦,|Nâ€‹(w)âˆ©(XqâˆªYq)|)=Trueğ‘â„ğ‘’ğ‘ğ‘˜ğ‘¤subscriptğ‘—ğ‘¤ğ‘ğ‘¤subscriptğ‘‹1subscriptğ‘Œ1â€¦ğ‘ğ‘¤subscriptğ‘‹ğ‘subscriptğ‘Œğ‘Truecheck(w,j_{w},|N(w)\\cap(X_{1}\\cup Y_{1})|,\\ldots,|N(w)\\cap(X_{q}\\cup Y_{q})|)=\\textsc{True}, where jwsubscriptğ‘—ğ‘¤j_{w} is such that wâˆˆXjwğ‘¤subscriptğ‘‹subscriptğ‘—ğ‘¤w\\in X_{j_{w}}, |X|+|Y|=Kğ‘‹ğ‘Œğ¾|X|+|Y|=K and Gâ€‹[XCâˆªYC]ğºdelimited-[]subscriptğ‘‹ğ¶subscriptğ‘Œğ¶G[X_{C}\\cup Y_{C}] is connected for each Câˆˆğ’ğ¶ğ’C\\in\\mathcal{C}.\nWe say that a tuple (X,Râ€²)âˆˆpartqâ€‹(Tv)Ã—â„›d,qvÂ¯ğ‘‹superscriptğ‘…â€²subscriptpartğ‘subscriptğ‘‡ğ‘£superscriptsubscriptâ„›ğ‘‘ğ‘Â¯ğ‘£(X,R^{\\prime})\\in\\textrm{part}_{q}(T_{v})\\times\\mathcal{R}_{d,q}^{\\overline{v}} is Tvsubscriptğ‘‡ğ‘£T_{v}-partially valid if for any vertex wâˆˆTvğ‘¤subscriptğ‘‡ğ‘£w\\in T_{v} and for a representative Yâ‰¡d,qvÂ¯Râ€²superscriptsubscriptğ‘‘ğ‘Â¯ğ‘£ğ‘Œsuperscriptğ‘…â€²Y\\equiv_{d,q}^{\\overline{v}}R^{\\prime} we have câ€‹hâ€‹eâ€‹câ€‹kâ€‹(w,jw,|Nâ€‹(w)âˆ©(X1âˆªY1)|,â€¦,|Nâ€‹(w)âˆ©(XqâˆªYq)|)=Trueğ‘â„ğ‘’ğ‘ğ‘˜ğ‘¤subscriptğ‘—ğ‘¤ğ‘ğ‘¤subscriptğ‘‹1subscriptğ‘Œ1â€¦ğ‘ğ‘¤subscriptğ‘‹ğ‘subscriptğ‘Œğ‘Truecheck(w,j_{w},|N(w)\\cap(X_{1}\\cup Y_{1})|,\\ldots,|N(w)\\cap(X_{q}\\cup Y_{q})|)=\\textsc{True}, where jwsubscriptğ‘—ğ‘¤j_{w} is such that wâˆˆXjwğ‘¤subscriptğ‘‹subscriptğ‘—ğ‘¤w\\in X_{j_{w}}.\nObserve that all of these notions are well-defined by the definition of the equivalence relation â‰¡d,qvsuperscriptsubscriptğ‘‘ğ‘ğ‘£\\equiv_{d,q}^{v}. We now explain the general idea of the algorithm.\nFor every node vâˆˆVâ€‹(T)ğ‘£ğ‘‰ğ‘‡v\\in V(T) and for every Râˆˆâ„›d,qvğ‘…superscriptsubscriptâ„›ğ‘‘ğ‘ğ‘£R\\in\\mathcal{R}_{d,q}^{v}, Râ€²âˆˆâ„›d,qvÂ¯superscriptğ‘…â€²superscriptsubscriptâ„›ğ‘‘ğ‘Â¯ğ‘£R^{\\prime}\\in\\mathcal{R}_{d,q}^{\\overline{v}}, Kâ€²âˆˆpartqâ€‹(|Tv|)superscriptğ¾â€²subscriptpartğ‘subscriptğ‘‡ğ‘£K^{\\prime}\\in\\textrm{part}_{q}(|T_{v}|), we will compute a set Mvâ€‹[R,Râ€²,Kâ€²]âŠ†partqâ€‹(Tv)subscriptğ‘€ğ‘£ğ‘…superscriptğ‘…â€²superscriptğ¾â€²subscriptpartğ‘subscriptğ‘‡ğ‘£M_{v}[R,R^{\\prime},K^{\\prime}]\\subseteq\\textrm{part}_{q}(T_{v}) such that |Mvâ€‹[R,Râ€²,Kâ€²]|â‰¤2|ğ’|â€‹snecd,qâ€‹(T)2â€‹|ğ’|subscriptğ‘€ğ‘£ğ‘…superscriptğ‘…â€²superscriptğ¾â€²superscript2ğ’subscriptsnecğ‘‘ğ‘superscriptğ‘‡2ğ’|M_{v}[R,R^{\\prime},K^{\\prime}]|\\leq 2^{|\\mathcal{C}|}\\textrm{snec}_{d,q}(T)^{2|\\mathcal{C}|}, for every XâˆˆMvâ€‹(R,Râ€²,Kâ€²)ğ‘‹subscriptğ‘€ğ‘£ğ‘…superscriptğ‘…â€²superscriptğ¾â€²X\\in M_{v}(R,R^{\\prime},K^{\\prime}) we have that Xâ‰¡d,qvRsuperscriptsubscriptğ‘‘ğ‘ğ‘£ğ‘‹ğ‘…X\\equiv_{d,q}^{v}R, |X|=Kâ€²ğ‘‹superscriptğ¾â€²|X|=K^{\\prime} and that (X,Râ€²)ğ‘‹superscriptğ‘…â€²(X,R^{\\prime}) is Tvsubscriptğ‘‡ğ‘£T_{v}-partially valid, and for every Xâˆˆpartqâ€‹(Tv)ğ‘‹subscriptpartğ‘subscriptğ‘‡ğ‘£X\\in\\textrm{part}_{q}(T_{v}) with Xâ‰¡d,qvRsuperscriptsubscriptğ‘‘ğ‘ğ‘£ğ‘‹ğ‘…X\\equiv_{d,q}^{v}R, |X|=Kâ€²ğ‘‹superscriptğ¾â€²|X|=K^{\\prime} and every Yâˆˆpartqâ€‹(TvÂ¯)ğ‘Œsubscriptpartğ‘subscriptğ‘‡Â¯ğ‘£Y\\in\\textrm{part}_{q}(T_{\\overline{v}}) such that Yâ‰¡d,qvÂ¯Râ€²superscriptsubscriptğ‘‘ğ‘Â¯ğ‘£ğ‘Œsuperscriptğ‘…â€²Y\\equiv_{d,q}^{\\overline{v}}R^{\\prime} and (X,Y)ğ‘‹ğ‘Œ(X,Y) is Tvsubscriptğ‘‡ğ‘£T_{v}-valid there is an Xâ€²âˆˆMvâ€‹[R,Râ€²,Kâ€²]superscriptğ‘‹â€²subscriptğ‘€ğ‘£ğ‘…superscriptğ‘…â€²superscriptğ¾â€²X^{\\prime}\\in M_{v}[R,R^{\\prime},K^{\\prime}] such that wâ€‹(Xâ€²,Y)âª¯wâ€‹(X,Y)precedes-or-equalswsuperscriptğ‘‹â€²ğ‘Œwğ‘‹ğ‘Œ\\textsc{w}(X^{\\prime},Y)\\preceq\\textsc{w}(X,Y) and (Xâ€²,Y)superscriptğ‘‹â€²ğ‘Œ(X^{\\prime},Y) is Tvsubscriptğ‘‡ğ‘£T_{v}-valid. Let rğ‘Ÿr be the root of Tğ‘‡T.\nObserve that TrÂ¯=âˆ…subscriptğ‘‡Â¯ğ‘ŸT_{\\overline{r}}=\\emptyset and thus for every X,Xâ€²âˆˆpartqâ€‹(Tr)ğ‘‹superscriptğ‘‹â€²subscriptpartğ‘subscriptğ‘‡ğ‘ŸX,X^{\\prime}\\in\\textrm{part}_{q}(T_{r}), we have that Xâ‰¡d,qrXâ€²superscriptsubscriptğ‘‘ğ‘ğ‘Ÿğ‘‹superscriptğ‘‹â€²X\\equiv_{d,q}^{r}X^{\\prime}.\nWe further have that â„›d,qrsuperscriptsubscriptâ„›ğ‘‘ğ‘ğ‘Ÿ\\mathcal{R}_{d,q}^{r} contains only one element, namely [âˆ…q]delimited-[]superscriptğ‘[\\emptyset^{q}].\nIt follows that Mrâ€‹[[âˆ…q],[âˆ…q],K]subscriptğ‘€ğ‘Ÿdelimited-[]superscriptğ‘delimited-[]superscriptğ‘ğ¾M_{r}[[\\emptyset^{q}],[\\emptyset^{q}],K] has to contain an optimal solution of our problem, if and only if such a solution exists.\nIn order to solve the problem we just need to search for an XâˆˆMrâ€‹[[âˆ…q],[âˆ…q],K]ğ‘‹subscriptğ‘€ğ‘Ÿdelimited-[]superscriptğ‘delimited-[]superscriptğ‘ğ¾X\\in M_{r}[[\\emptyset^{q}],[\\emptyset^{q}],K] of minimum weight wâ€‹(X,âˆ…q)wğ‘‹superscriptğ‘\\textsc{w}(X,\\emptyset^{q}) such that (X,âˆ…q)ğ‘‹superscriptğ‘(X,\\emptyset^{q}) is Trsubscriptğ‘‡ğ‘ŸT_{r}-valid.\nNotice that the size of Mrâ€‹[[âˆ…q],[âˆ…q],K]subscriptğ‘€ğ‘Ÿdelimited-[]superscriptğ‘delimited-[]superscriptğ‘ğ¾M_{r}[[\\emptyset^{q}],[\\emptyset^{q}],K] is at most 2|ğ’|â€‹snecd,qâ€‹(T)2â€‹|ğ’|superscript2ğ’subscriptsnecğ‘‘ğ‘superscriptğ‘‡2ğ’2^{|\\mathcal{C}|}\\textrm{snec}_{d,q}(T)^{2|\\mathcal{C}|}, and that checking if (X,âˆ…q)ğ‘‹superscriptğ‘(X,\\emptyset^{q}) is Trsubscriptğ‘‡ğ‘ŸT_{r}-valid (knowing that (X,[âˆ…q])ğ‘‹delimited-[]superscriptğ‘(X,[\\emptyset^{q}]) is Trsubscriptğ‘‡ğ‘ŸT_{r}-partially valid) and computing wâ€‹(X,âˆ…q)wğ‘‹superscriptğ‘\\textsc{w}(X,\\emptyset^{q}) can be done in Oâ€‹(n2)ğ‘‚superscriptğ‘›2O(n^{2}) time.\nTherefore, given the set Mrâ€‹[[âˆ…q],[âˆ…q],K]subscriptğ‘€ğ‘Ÿdelimited-[]superscriptğ‘delimited-[]superscriptğ‘ğ¾M_{r}[[\\emptyset^{q}],[\\emptyset^{q}],K], finding an optimal solution there (or discovering that no solution exists) can be done in time Oâ€‹(snecd,qâ€‹(T)2â€‹|ğ’|â€‹n2)ğ‘‚subscriptsnecğ‘‘ğ‘superscriptğ‘‡2ğ’superscriptğ‘›2O(\\textrm{snec}_{d,q}(T)^{2|\\mathcal{C}|}n^{2}). We will compute these sets Mvâ€‹[R,Râ€²,Kâ€²]subscriptğ‘€ğ‘£ğ‘…superscriptğ‘…â€²superscriptğ¾â€²M_{v}[R,R^{\\prime},K^{\\prime}] by the standard dynamic programming bottom-up approach.\nWe start by computing them whenever vğ‘£v is a leaf of Tğ‘‡T.\nThen, Tvsubscriptğ‘‡ğ‘£T_{v} contains a single vertex wğ‘¤w of GğºG and for each equivalence class in â„›d,qvsuperscriptsubscriptâ„›ğ‘‘ğ‘ğ‘£\\mathcal{R}_{d,q}^{v} there is just one representative.\nThus, for each Râˆˆâ„›d,qvğ‘…superscriptsubscriptâ„›ğ‘‘ğ‘ğ‘£R\\in\\mathcal{R}_{d,q}^{v} and Râ€²âˆˆâ„›d,qvÂ¯superscriptğ‘…â€²superscriptsubscriptâ„›ğ‘‘ğ‘Â¯ğ‘£R^{\\prime}\\in\\mathcal{R}_{d,q}^{\\overline{v}} we let Xğ‘‹X be the unique representative of Rğ‘…R and if Xâˆˆpartqâ€‹(Tv)ğ‘‹subscriptpartğ‘subscriptğ‘‡ğ‘£X\\in\\textrm{part}_{q}(T_{v}) and (X,Râ€²)ğ‘‹superscriptğ‘…â€²(X,R^{\\prime}) is Tvsubscriptğ‘‡ğ‘£T_{v}-partially valid then we set Mvâ€‹[R,Râ€²,|X|]={X}subscriptğ‘€ğ‘£ğ‘…superscriptğ‘…â€²ğ‘‹ğ‘‹M_{v}[R,R^{\\prime},|X|]=\\left\\{X\\right\\} and to âˆ…\\emptyset if not.\nFor every Kâ€²â‰ |X|superscriptğ¾â€²ğ‘‹K^{\\prime}\\neq|X|, we set Mvâ€‹[R,Râ€²,Kâ€²]=âˆ…subscriptğ‘€ğ‘£ğ‘…superscriptğ‘…â€²superscriptğ¾â€²M_{v}[R,R^{\\prime},K^{\\prime}]=\\emptyset. Now let vğ‘£v be a non-leaf node of Tğ‘‡T.\nLet ağ‘a and bğ‘b be the children of vğ‘£v, and assume we have already correctly computed the sets Maâ€‹[Ra,Raâ€²,Ka]subscriptğ‘€ğ‘subscriptğ‘…ğ‘subscriptsuperscriptğ‘…â€²ğ‘subscriptğ¾ğ‘M_{a}[R_{a},R^{\\prime}_{a},K_{a}] for every Raâˆˆâ„›d,qasubscriptğ‘…ğ‘superscriptsubscriptâ„›ğ‘‘ğ‘ğ‘R_{a}\\in\\mathcal{R}_{d,q}^{a}, Raâ€²âˆˆâ„›d,qaÂ¯subscriptsuperscriptğ‘…â€²ğ‘superscriptsubscriptâ„›ğ‘‘ğ‘Â¯ğ‘R^{\\prime}_{a}\\in\\mathcal{R}_{d,q}^{\\overline{a}} and Kaâˆˆpartqâ€‹(|Ta|)subscriptğ¾ğ‘subscriptpartğ‘subscriptğ‘‡ğ‘K_{a}\\in\\textrm{part}_{q}(|T_{a}|), as well as Mbâ€‹[Rb,Rbâ€²,Kb]subscriptğ‘€ğ‘subscriptğ‘…ğ‘subscriptsuperscriptğ‘…â€²ğ‘subscriptğ¾ğ‘M_{b}[R_{b},R^{\\prime}_{b},K_{b}] for every Rbâˆˆâ„›d,qbsubscriptğ‘…ğ‘superscriptsubscriptâ„›ğ‘‘ğ‘ğ‘R_{b}\\in\\mathcal{R}_{d,q}^{b}, Rbâ€²âˆˆâ„›d,qbÂ¯subscriptsuperscriptğ‘…â€²ğ‘superscriptsubscriptâ„›ğ‘‘ğ‘Â¯ğ‘R^{\\prime}_{b}\\in\\mathcal{R}_{d,q}^{\\overline{b}} and Kbâˆˆpartqâ€‹(|Tb|)subscriptğ¾ğ‘subscriptpartğ‘subscriptğ‘‡ğ‘K_{b}\\in\\textrm{part}_{q}(|T_{b}|).\nFor Râˆˆâ„›d,qvğ‘…superscriptsubscriptâ„›ğ‘‘ğ‘ğ‘£R\\in\\mathcal{R}_{d,q}^{v}, Râ€²âˆˆâ„›d,qvÂ¯superscriptğ‘…â€²superscriptsubscriptâ„›ğ‘‘ğ‘Â¯ğ‘£R^{\\prime}\\in\\mathcal{R}_{d,q}^{\\overline{v}} and Kâ€²âˆˆpartqâ€‹(|Tv|)superscriptğ¾â€²subscriptpartğ‘subscriptğ‘‡ğ‘£K^{\\prime}\\in\\textrm{part}_{q}(|T_{v}|), we say that two tuples (Ra,Raâ€²,Ka)âˆˆâ„›d,qaÃ—â„›d,qaÂ¯Ã—partqâ€‹(|Ta|)subscriptğ‘…ğ‘superscriptsubscriptğ‘…ğ‘â€²superscriptğ¾ğ‘superscriptsubscriptâ„›ğ‘‘ğ‘ğ‘superscriptsubscriptâ„›ğ‘‘ğ‘Â¯ğ‘subscriptpartğ‘subscriptğ‘‡ğ‘(R_{a},R_{a}^{\\prime},K^{a})\\in\\mathcal{R}_{d,q}^{a}\\times\\mathcal{R}_{d,q}^{\\overline{a}}\\times\\textrm{part}_{q}(|T_{a}|) and (Rb,Rbâ€²,Kb)âˆˆâ„›d,qbÃ—â„›d,qbÂ¯Ã—partqâ€‹(|Tb|)subscriptğ‘…ğ‘superscriptsubscriptğ‘…ğ‘â€²superscriptğ¾ğ‘superscriptsubscriptâ„›ğ‘‘ğ‘ğ‘superscriptsubscriptâ„›ğ‘‘ğ‘Â¯ğ‘subscriptpartğ‘subscriptğ‘‡ğ‘(R_{b},R_{b}^{\\prime},K^{b})\\in\\mathcal{R}_{d,q}^{b}\\times\\mathcal{R}_{d,q}^{\\overline{b}}\\times\\textrm{part}_{q}(|T_{b}|) are (R,Râ€²,Kâ€²)ğ‘…superscriptğ‘…â€²superscriptğ¾â€²(R,R^{\\prime},K^{\\prime})-compatible if\nKa+Kb=Kâ€²superscriptğ¾ğ‘superscriptğ¾ğ‘superscriptğ¾â€²K^{a}+K^{b}=K^{\\prime}\nand, for representatives Y,Yâ€²,Ya,Yaâ€²,Yb,Ybâ€²ğ‘Œsuperscriptğ‘Œâ€²subscriptğ‘Œğ‘subscriptsuperscriptğ‘Œâ€²ğ‘subscriptğ‘Œğ‘subscriptsuperscriptğ‘Œâ€²ğ‘Y,Y^{\\prime},Y_{a},Y^{\\prime}_{a},Y_{b},Y^{\\prime}_{b} of R,Râ€²,Ra,Raâ€²,Rb,Rbâ€²ğ‘…superscriptğ‘…â€²subscriptğ‘…ğ‘subscriptsuperscriptğ‘…â€²ğ‘subscriptğ‘…ğ‘subscriptsuperscriptğ‘…â€²ğ‘R,R^{\\prime},R_{a},R^{\\prime}_{a},R_{b},R^{\\prime}_{b} respectively, we have\nYaâˆªYbâ‰¡d,qvYsuperscriptsubscriptğ‘‘ğ‘ğ‘£subscriptğ‘Œğ‘subscriptğ‘Œğ‘ğ‘ŒY_{a}\\cup Y_{b}\\equiv_{d,q}^{v}Y, YbâˆªYâ€²â‰¡d,qaÂ¯Yaâ€²superscriptsubscriptğ‘‘ğ‘Â¯ğ‘subscriptğ‘Œğ‘superscriptğ‘Œâ€²subscriptsuperscriptğ‘Œâ€²ğ‘Y_{b}\\cup Y^{\\prime}\\equiv_{d,q}^{\\overline{a}}Y^{\\prime}_{a}, YaâˆªYâ€²â‰¡d,qbÂ¯Ybâ€²superscriptsubscriptğ‘‘ğ‘Â¯ğ‘subscriptğ‘Œğ‘superscriptğ‘Œâ€²subscriptsuperscriptğ‘Œâ€²ğ‘Y_{a}\\cup Y^{\\prime}\\equiv_{d,q}^{\\overline{b}}Y^{\\prime}_{b}.\nFor some fixed Râˆˆâ„›d,qvğ‘…superscriptsubscriptâ„›ğ‘‘ğ‘ğ‘£R\\in\\mathcal{R}_{d,q}^{v}, Râ€²âˆˆâ„›d,qvÂ¯superscriptğ‘…â€²superscriptsubscriptâ„›ğ‘‘ğ‘Â¯ğ‘£R^{\\prime}\\in\\mathcal{R}_{d,q}^{\\overline{v}} and Kâ€²âˆˆpartqâ€‹(|Tv|)superscriptğ¾â€²subscriptpartğ‘subscriptğ‘‡ğ‘£K^{\\prime}\\in\\textrm{part}_{q}(|T_{v}|) consider the set Here the union is indexed over all tuples (Ra,Raâ€²,Ka)subscriptğ‘…ğ‘superscriptsubscriptğ‘…ğ‘â€²superscriptğ¾ğ‘(R_{a},R_{a}^{\\prime},K^{a}) and (Rb,Rbâ€²,Kb)subscriptğ‘…ğ‘superscriptsubscriptğ‘…ğ‘â€²superscriptğ¾ğ‘(R_{b},R_{b}^{\\prime},K^{b}) which are as above and (R,Râ€²,Kâ€²)ğ‘…superscriptğ‘…â€²superscriptğ¾â€²(R,R^{\\prime},K^{\\prime})-compatible.\nWe first show that this set has all the properties demanded from Mvâ€‹[R,Râ€²,Kâ€²]subscriptğ‘€ğ‘£ğ‘…superscriptğ‘…â€²superscriptğ¾â€²M_{v}[R,R^{\\prime},K^{\\prime}] except for the upper bound on the size, and then we show a way to reduce the size of the set without losing these other properties.\nNotice that the size of â„³â„³\\mathcal{M} could be as large as nqâ‹…snecd,qâ€‹(T)4â‹…(2|ğ’|â€‹snecd,qâ€‹(T)2â€‹|ğ’|)2â‹…â‹…superscriptğ‘›ğ‘subscriptsnecğ‘‘ğ‘superscriptğ‘‡4superscriptsuperscript2ğ’subscriptsnecğ‘‘ğ‘superscriptğ‘‡2ğ’2n^{q}\\cdot\\textrm{snec}_{d,q}(T)^{4}\\cdot\\left(2^{|\\mathcal{C}|}\\textrm{snec}_{d,q}(T)^{2|\\mathcal{C}|}\\right)^{2} because we are assuming that Maâ€‹[Ra,Raâ€²,Ka]subscriptğ‘€ğ‘subscriptğ‘…ğ‘superscriptsubscriptğ‘…ğ‘â€²superscriptğ¾ğ‘M_{a}[R_{a},R_{a}^{\\prime},K^{a}] and Mbâ€‹[Rb,Rbâ€²,Kb]subscriptğ‘€ğ‘subscriptğ‘…ğ‘superscriptsubscriptğ‘…ğ‘â€²superscriptğ¾ğ‘M_{b}[R_{b},R_{b}^{\\prime},K^{b}] are of size at most 2|ğ’|â€‹snecd,qâ€‹(T)2â€‹|ğ’|superscript2ğ’subscriptsnecğ‘‘ğ‘superscriptğ‘‡2ğ’2^{|\\mathcal{C}|}\\textrm{snec}_{d,q}(T)^{2|\\mathcal{C}|} and there are at most nqâ‹…snecd,qâ€‹(T)4â‹…superscriptğ‘›ğ‘subscriptsnecğ‘‘ğ‘superscriptğ‘‡4n^{q}\\cdot\\textrm{snec}_{d,q}(T)^{4} pairs of tuples (Ra,Raâ€²,Ka)subscriptğ‘…ğ‘superscriptsubscriptğ‘…ğ‘â€²superscriptğ¾ğ‘(R_{a},R_{a}^{\\prime},K^{a}) and (Rb,Rbâ€²,Kb)subscriptğ‘…ğ‘superscriptsubscriptğ‘…ğ‘â€²superscriptğ¾ğ‘(R_{b},R_{b}^{\\prime},K^{b}) that are (R,Râ€²,Kâ€²)ğ‘…superscriptğ‘…â€²superscriptğ¾â€²(R,R^{\\prime},K^{\\prime})-compatible (there are at most nqsuperscriptğ‘›ğ‘n^{q} possible values for Kasuperscriptğ¾ğ‘K^{a} and for each of them there is only one choice for Kbsuperscriptğ¾ğ‘K^{b}, and there are at most snecd,qâ€‹(T)subscriptsnecğ‘‘ğ‘ğ‘‡\\textrm{snec}_{d,q}(T) possible values for each Ra,Raâ€²,Rb,Rbâ€²subscriptğ‘…ğ‘superscriptsubscriptğ‘…ğ‘â€²subscriptğ‘…ğ‘superscriptsubscriptğ‘…ğ‘â€²R_{a},R_{a}^{\\prime},R_{b},R_{b}^{\\prime}). Let (R,Râ€²,Kâ€²)ğ‘…superscriptğ‘…â€²superscriptğ¾â€²(R,R^{\\prime},K^{\\prime}) be as above and Xâˆˆpartqâ€‹(Tv)ğ‘‹subscriptpartğ‘subscriptğ‘‡ğ‘£X\\in\\textrm{part}_{q}(T_{v}) be such that Xâ‰¡d,qvRsuperscriptsubscriptğ‘‘ğ‘ğ‘£ğ‘‹ğ‘…X\\equiv_{d,q}^{v}R and |X|=Kâ€²ğ‘‹superscriptğ¾â€²|X|=K^{\\prime}.\nSuppose there exists Yâˆˆpartqâ€‹(TvÂ¯)ğ‘Œsubscriptpartğ‘subscriptğ‘‡Â¯ğ‘£Y\\in\\textrm{part}_{q}(T_{\\overline{v}}) such that Yâ‰¡d,qvÂ¯Râ€²superscriptsubscriptğ‘‘ğ‘Â¯ğ‘£ğ‘Œsuperscriptğ‘…â€²Y\\equiv_{d,q}^{\\overline{v}}R^{\\prime} and (X,Y)ğ‘‹ğ‘Œ(X,Y) is Tvsubscriptğ‘‡ğ‘£T_{v}-valid.\nSet Xa=Taâˆ©Xsuperscriptğ‘‹ğ‘subscriptğ‘‡ğ‘ğ‘‹X^{a}=T_{a}\\cap X, Xb=Tbâˆ©Xsuperscriptğ‘‹ğ‘subscriptğ‘‡ğ‘ğ‘‹X^{b}=T_{b}\\cap X, Xâ€²â£a=XbâˆªYsuperscriptğ‘‹â€²ğ‘superscriptğ‘‹ğ‘ğ‘ŒX^{\\prime a}=X^{b}\\cup Y, Xâ€²â£b=XaâˆªYsuperscriptğ‘‹â€²ğ‘superscriptğ‘‹ğ‘ğ‘ŒX^{\\prime b}=X^{a}\\cup Y, Ka=|Xa|superscriptğ¾ğ‘superscriptğ‘‹ğ‘K^{a}=|X^{a}| and Kb=|Xb|superscriptğ¾ğ‘superscriptğ‘‹ğ‘K^{b}=|X^{b}|.\nClearly (Xa,Xâ€²â£a)superscriptğ‘‹ğ‘superscriptğ‘‹â€²ğ‘(X^{a},X^{\\prime a}) is Tasubscriptğ‘‡ğ‘T_{a}-valid, (Xb,Xâ€²â£b)superscriptğ‘‹ğ‘superscriptğ‘‹â€²ğ‘(X^{b},X^{\\prime b}) is Tbsubscriptğ‘‡ğ‘T_{b}-valid and Ka+Kb=Kâ€²superscriptğ¾ğ‘superscriptğ¾ğ‘superscriptğ¾â€²K^{a}+K^{b}=K^{\\prime}, hence Maâ€‹[[Xa],[Xâ€²â£a],Ka]subscriptğ‘€ğ‘delimited-[]superscriptğ‘‹ğ‘delimited-[]superscriptğ‘‹â€²ğ‘superscriptğ¾ğ‘M_{a}[[X^{a}],[X^{\\prime a}],K^{a}] and Mbâ€‹[[Xb],[Xâ€²â£b],Kb]subscriptğ‘€ğ‘delimited-[]superscriptğ‘‹ğ‘delimited-[]superscriptğ‘‹â€²ğ‘superscriptğ¾ğ‘M_{b}[[X^{b}],[X^{\\prime b}],K^{b}] are not empty. Let Connâ€‹(Za,Zb,Y,ğ’)Connsuperscriptğ‘ğ‘superscriptğ‘ğ‘ğ‘Œğ’\\textsc{Conn}(Z^{a},Z^{b},Y,\\mathcal{C}) denote the statement â€œ(Za)Câˆª(Zb)CâˆªYCsubscriptsuperscriptğ‘ğ‘ğ¶subscriptsuperscriptğ‘ğ‘ğ¶subscriptğ‘Œğ¶(Z^{a})_{C}\\cup(Z^{b})_{C}\\cup Y_{C} is connected for each Câˆˆğ’ğ¶ğ’C\\in\\mathcal{C}â€.\nObserve that It follows that there are ZaâˆˆMaâ€‹[[Xa],[Xâ€²â£a],Ka]superscriptğ‘ğ‘subscriptğ‘€ğ‘delimited-[]superscriptğ‘‹ğ‘delimited-[]superscriptğ‘‹â€²ğ‘superscriptğ¾ğ‘Z^{a}\\in M_{a}[[X^{a}],[X^{\\prime a}],K^{a}] and ZbâˆˆMbâ€‹[[Xb],[Xâ€²â£b],Kb]superscriptğ‘ğ‘subscriptğ‘€ğ‘delimited-[]superscriptğ‘‹ğ‘delimited-[]superscriptğ‘‹â€²ğ‘superscriptğ¾ğ‘Z^{b}\\in M_{b}[[X^{b}],[X^{\\prime b}],K^{b}] such that wâ€‹(ZaâˆªZb,Y)âª¯wâ€‹(XaâˆªXb,Y)=wâ€‹(X,Y)precedes-or-equalswsuperscriptğ‘ğ‘superscriptğ‘ğ‘ğ‘Œwsuperscriptğ‘‹ğ‘superscriptğ‘‹ğ‘ğ‘Œwğ‘‹ğ‘Œ\\textsc{w}(Z^{a}\\cup Z^{b},Y)\\preceq\\textsc{w}(X^{a}\\cup X^{b},Y)=\\textsc{w}(X,Y).\nFurther, (ZaâˆªZb,Y)superscriptğ‘ğ‘superscriptğ‘ğ‘ğ‘Œ(Z^{a}\\cup Z^{b},Y) is Tvsubscriptğ‘‡ğ‘£T_{v}-valid.\nIndeed, the connectivity constraints are satisfied by the above and the other constraints follow from the definition of Masubscriptğ‘€ğ‘M_{a} and Mbsubscriptğ‘€ğ‘M_{b}. Succinctly, for every Xâˆˆpartqâ€‹(Tv)ğ‘‹subscriptpartğ‘subscriptğ‘‡ğ‘£X\\in\\textrm{part}_{q}(T_{v}) with Xâ‰¡d,qvRsuperscriptsubscriptğ‘‘ğ‘ğ‘£ğ‘‹ğ‘…X\\equiv_{d,q}^{v}R and |X|=Kâ€²ğ‘‹superscriptğ¾â€²|X|=K^{\\prime}, and every Yâˆˆpartqâ€‹(TvÂ¯)ğ‘Œsubscriptpartğ‘subscriptğ‘‡Â¯ğ‘£Y\\in\\textrm{part}_{q}(T_{\\overline{v}}) such that Yâ‰¡d,qvÂ¯Râ€²superscriptsubscriptğ‘‘ğ‘Â¯ğ‘£ğ‘Œsuperscriptğ‘…â€²Y\\equiv_{d,q}^{\\overline{v}}R^{\\prime} and (X,Y)ğ‘‹ğ‘Œ(X,Y) is Tvsubscriptğ‘‡ğ‘£T_{v}-valid, there exists Zâˆˆâ„³ğ‘â„³Z\\in\\mathcal{M} such that wâ€‹(Z,Y)âª¯wâ€‹(X,Y)precedes-or-equalswğ‘ğ‘Œwğ‘‹ğ‘Œ\\textsc{w}(Z,Y)\\preceq\\textsc{w}(X,Y) and (Z,Y)ğ‘ğ‘Œ(Z,Y) is Tvsubscriptğ‘‡ğ‘£T_{v}-valid. We are now going to show that we can find a subset of â„³â„³\\mathcal{M} which has cardinality at most 2|ğ’|â€‹snecd,qâ€‹(T)2â€‹|ğ’|superscript2ğ’subscriptsnecğ‘‘ğ‘superscriptğ‘‡2ğ’2^{|\\mathcal{C}|}\\textrm{snec}_{d,q}(T)^{2|\\mathcal{C}|} and keeps the property we have just shown.\nObserve that any subset of â„³â„³\\mathcal{M} can only contain partitions of Tvsubscriptğ‘‡ğ‘£T_{v} which are Tvsubscriptğ‘‡ğ‘£T_{v}-partially valid together with Râ€²superscriptğ‘…â€²R^{\\prime} and who have the correct partition size.\nThus, when choosing a subset of â„³â„³\\mathcal{M}, we only have to focus on keeping the partial solutions which are part of an optimal solution. Let vâˆˆVâ€‹(T)ğ‘£ğ‘‰ğ‘‡v\\in V(T), Râ€²âˆˆâ„›d,qvÂ¯superscriptğ‘…â€²superscriptsubscriptâ„›ğ‘‘ğ‘Â¯ğ‘£R^{\\prime}\\in\\mathcal{R}_{d,q}^{\\overline{v}}, ğ’³âŠ†partqâ€‹(Tv)ğ’³subscriptpartğ‘subscriptğ‘‡ğ‘£\\mathcal{X}\\subseteq\\textrm{part}_{q}(T_{v}) as well as ğ’³â€²âŠ†ğ’³superscriptğ’³â€²ğ’³\\mathcal{X}^{\\prime}\\subseteq\\mathcal{X}.\nWe say that ğ’³â€²superscriptğ’³â€²\\mathcal{X}^{\\prime} does (v,Râ€²)ğ‘£superscriptğ‘…â€²(v,R^{\\prime})-represent ğ’³ğ’³\\mathcal{X} if, for every\nXâˆˆğ’³ğ‘‹ğ’³X\\in\\mathcal{X} and Yâˆˆpartqâ€‹(TvÂ¯)ğ‘Œsubscriptpartğ‘subscriptğ‘‡Â¯ğ‘£Y\\in\\textrm{part}_{q}(T_{\\overline{v}}) such that Yâ‰¡d,qvÂ¯Râ€²superscriptsubscriptğ‘‘ğ‘Â¯ğ‘£ğ‘Œsuperscriptğ‘…â€²Y\\equiv_{d,q}^{\\overline{v}}R^{\\prime} and XCâˆªYCsubscriptğ‘‹ğ¶subscriptğ‘Œğ¶X_{C}\\cup Y_{C} is connected for every Câˆˆğ’ğ¶ğ’C\\in\\mathcal{C}, there exists Xâ€²âˆˆğ’³â€²superscriptğ‘‹â€²superscriptğ’³â€²X^{\\prime}\\in\\mathcal{X}^{\\prime} such that XCâ€²âˆªYCsubscriptsuperscriptğ‘‹â€²ğ¶subscriptğ‘Œğ¶X^{\\prime}_{C}\\cup Y_{C} is connected for every Câˆˆğ’ğ¶ğ’C\\in\\mathcal{C} and wâ€‹(Xâ€²,Râ€²)âª¯wâ€‹(X,Râ€²)precedes-or-equalswsuperscriptğ‘‹â€²superscriptğ‘…â€²wğ‘‹superscriptğ‘…â€²\\textsc{w}(X^{\\prime},R^{\\prime})\\preceq\\textsc{w}(X,R^{\\prime}). Let vâˆˆVâ€‹(T)ğ‘£ğ‘‰ğ‘‡v\\in V(T) and Râˆˆâ„›d,qvğ‘…superscriptsubscriptâ„›ğ‘‘ğ‘ğ‘£R\\in\\mathcal{R}_{d,q}^{v}, Râ€²âˆˆâ„›d,qvÂ¯superscriptğ‘…â€²superscriptsubscriptâ„›ğ‘‘ğ‘Â¯ğ‘£R^{\\prime}\\in\\mathcal{R}_{d,q}^{\\overline{v}}.\nLet ğ’³âŠ†partqâ€‹(Tv)ğ’³subscriptpartğ‘subscriptğ‘‡ğ‘£\\mathcal{X}\\subseteq\\textrm{part}_{q}(T_{v}) be such that Xâ‰¡d,qvRsuperscriptsubscriptğ‘‘ğ‘ğ‘£ğ‘‹ğ‘…X\\equiv_{d,q}^{v}R for every Xâˆˆğ’³ğ‘‹ğ’³X\\in\\mathcal{X}.\nWe can find a set (v,Râ€²)ğ‘£superscriptğ‘…â€²(v,R^{\\prime})-representing ğ’³ğ’³\\mathcal{X} of cardinality at most 2|ğ’|â€‹snecd,qâ€‹(T)2â€‹|ğ’|superscript2ğ’subscriptsnecğ‘‘ğ‘superscriptğ‘‡2ğ’2^{|\\mathcal{C}|}\\textrm{snec}_{d,q}(T)^{2|\\mathcal{C}|} in\nOâ€‹(|ğ’³|â‹…snecd,qâ€‹(T)2â€‹|ğ’|â‹…(n2+snecd,qâ€‹(T)Ï‰âˆ’1))ğ‘‚â‹…â‹…ğ’³subscriptsnecğ‘‘ğ‘superscriptğ‘‡2ğ’superscriptğ‘›2subscriptsnecğ‘‘ğ‘superscriptğ‘‡ğœ”1O(|\\mathcal{X}|\\cdot\\textrm{snec}_{d,q}(T)^{2|\\mathcal{C}|}\\cdot(n^{2}+\\textrm{snec}_{d,q}(T)^{\\omega-1}))\ntime,\nwhere Ï‰ğœ”\\omega is the matrix multiplication exponent (Ï‰<2.4ğœ”2.4\\omega<2.4Â ). Let ğ’âˆ…âŠ†ğ’subscriptğ’ğ’\\mathcal{C}_{\\emptyset}\\subseteq\\mathcal{C} be the set of all connectivity restraints Cğ¶C for which âˆ…â‰¡dvÂ¯RCâ€²superscriptsubscriptğ‘‘Â¯ğ‘£subscriptsuperscriptğ‘…â€²ğ¶\\emptyset\\equiv_{d}^{\\overline{v}}R^{\\prime}_{C}.\nFor any Câˆˆğ’âˆ…ğ¶subscriptğ’C\\in\\mathcal{C}_{\\emptyset} and for any Yâˆˆpartqâ€‹(TvÂ¯)ğ‘Œsubscriptpartğ‘subscriptğ‘‡Â¯ğ‘£Y\\in\\textrm{part}_{q}(T_{\\overline{v}}) with Yâ‰¡d,qvÂ¯Râ€²superscriptsubscriptğ‘‘ğ‘Â¯ğ‘£ğ‘Œsuperscriptğ‘…â€²Y\\equiv_{d,q}^{\\overline{v}}R^{\\prime}, notice that YCâ‰¡dvÂ¯âˆ…superscriptsubscriptğ‘‘Â¯ğ‘£subscriptğ‘Œğ¶Y_{C}\\equiv_{d}^{\\overline{v}}\\emptyset.\nAlso, if YC=âˆ…subscriptğ‘Œğ¶Y_{C}=\\emptyset then Yğ‘ŒY can only be completed to a Tvsubscriptğ‘‡ğ‘£T_{v}-valid coloring with a partition Xâˆˆğ’³ğ‘‹ğ’³X\\in\\mathcal{X} when XCsubscriptğ‘‹ğ¶X_{C} is connected; on the other hand, if YCâ‰ âˆ…subscriptğ‘Œğ¶Y_{C}\\neq\\emptyset then Yğ‘ŒY can only be completed to a Tvsubscriptğ‘‡ğ‘£T_{v}-valid coloring with a partition Xâˆˆğ’³ğ‘‹ğ’³X\\in\\mathcal{X} when XCsubscriptğ‘‹ğ¶X_{C} is empty, since otherwise XCâˆªYCsubscriptğ‘‹ğ¶subscriptğ‘Œğ¶X_{C}\\cup Y_{C} cannot be connected. Given a map Ï„:ğ’âˆ…â†’{0,1}:ğœâ†’subscriptğ’01\\tau:\\mathcal{C}_{\\emptyset}\\rightarrow\\left\\{0,1\\right\\} we say that a partition Xâˆˆğ’³ğ‘‹ğ’³X\\in\\mathcal{X} is of type Ï„ğœ\\tau if XC=âˆ…subscriptğ‘‹ğ¶X_{C}=\\emptyset for every CâˆˆÏ„âˆ’1â€‹(0)ğ¶superscriptğœ10C\\in\\tau^{-1}(0) and XCsubscriptğ‘‹ğ¶X_{C} is connected for every CâˆˆÏ„âˆ’1â€‹(1)ğ¶superscriptğœ11C\\in\\tau^{-1}(1).\nObserve that if ğ’âˆ…=âˆ…subscriptğ’\\mathcal{C}_{\\emptyset}=\\emptyset then Ï„ğœ\\tau can only be the empty map and then every Xğ‘‹X is of type Ï„ğœ\\tau.\nThere are at most 2|ğ’âˆ…|superscript2subscriptğ’2^{|\\mathcal{C}_{\\emptyset}|} possible maps from ğ’âˆ…subscriptğ’\\mathcal{C}_{\\emptyset} to {0,1}01\\left\\{0,1\\right\\}.\nFor each map Ï„ğœ\\tau as above we will compute a set ğ”›Ï„subscriptğ”›ğœ\\mathfrak{X}_{\\tau} of size at most snecd,qâ€‹(T)2â€‹|ğ’|subscriptsnecğ‘‘ğ‘superscriptğ‘‡2ğ’\\textrm{snec}_{d,q}(T)^{2|\\mathcal{C}|} that (v,Râ€²)ğ‘£superscriptğ‘…â€²(v,R^{\\prime})-represents the set {Xâˆˆğ’³:Xâ€‹Â has typeÂ â€‹Ï„}conditional-setğ‘‹ğ’³ğ‘‹Â has typeÂ ğœ\\left\\{X\\in\\mathcal{X}:X\\textrm{ has type }\\tau\\right\\}.\nWe claim that their union will yield a set as demanded.\nIndeed, for every Yâ‰¡d,qvÂ¯Râ€²superscriptsubscriptğ‘‘ğ‘Â¯ğ‘£ğ‘Œsuperscriptğ‘…â€²Y\\equiv_{d,q}^{\\overline{v}}R^{\\prime} we define a map Ï„Ysubscriptğœğ‘Œ\\tau_{Y} as above by mapping Câˆˆğ’âˆ…ğ¶subscriptğ’C\\in\\mathcal{C}_{\\emptyset} to 0 if YCsubscriptğ‘Œğ¶Y_{C} is non-empty and to 1 otherwise.\nBy the above, for any Xâˆˆğ’³ğ‘‹ğ’³X\\in\\mathcal{X} such that XCâˆªYCsubscriptğ‘‹ğ¶subscriptğ‘Œğ¶X_{C}\\cup Y_{C} is connected for every Câˆˆğ’ğ¶ğ’C\\in\\mathcal{C},\nwe have that Xğ‘‹X is of type Ï„Ysubscriptğœğ‘Œ\\tau_{Y}.\nThis implies that there is Xâ€²âˆˆğ”›Ï„Ysuperscriptğ‘‹â€²subscriptğ”›subscriptğœğ‘ŒX^{\\prime}\\in\\mathfrak{X}_{\\tau_{Y}} such that XCâ€²âˆªYCsubscriptsuperscriptğ‘‹â€²ğ¶subscriptğ‘Œğ¶X^{\\prime}_{C}\\cup Y_{C} is connected for every Câˆˆğ’ğ¶ğ’C\\in\\mathcal{C}\nand wâ€‹(Xâ€²,Y)âª¯wâ€‹(X,Y)precedes-or-equalswsuperscriptğ‘‹â€²ğ‘Œwğ‘‹ğ‘Œ\\textsc{w}(X^{\\prime},Y)\\preceq\\textsc{w}(X,Y).\nHence the union of all the ğ”›Ï„subscriptğ”›ğœ\\mathfrak{X}_{\\tau} is a (v,Râ€²)ğ‘£superscriptğ‘…â€²(v,R^{\\prime})-representative of ğ’³ğ’³\\mathcal{X}.\nFurther, if the size of each ğ”›Ï„subscriptğ”›ğœ\\mathfrak{X}_{\\tau} is indeed at most snecd,qâ€‹(T)2â€‹|ğ’|subscriptsnecğ‘‘ğ‘superscriptğ‘‡2ğ’\\textrm{snec}_{d,q}(T)^{2|\\mathcal{C}|}, then their union has size at most 2|ğ’âˆ…|â€‹snecd,qâ€‹(T)2â€‹|ğ’|â‰¤2|ğ’|â€‹snecd,qâ€‹(T)2â€‹|ğ’|superscript2subscriptğ’subscriptsnecğ‘‘ğ‘superscriptğ‘‡2ğ’superscript2ğ’subscriptsnecğ‘‘ğ‘superscriptğ‘‡2ğ’2^{|\\mathcal{C}_{\\emptyset}|}\\textrm{snec}_{d,q}(T)^{2|\\mathcal{C}|}\\leq 2^{|\\mathcal{C}|}\\textrm{snec}_{d,q}(T)^{2|\\mathcal{C}|}. It remains to show how to compute such a set ğ”›Ï„subscriptğ”›ğœ\\mathfrak{X}_{\\tau} for a fixed Ï„ğœ\\tau.\nFix a map Ï„ğœ\\tau as above and consider the set ğ’³Ï„subscriptğ’³ğœ\\mathcal{X}_{\\tau} consisting of every Xâˆˆğ’³ğ‘‹ğ’³X\\in\\mathcal{X} which has type Ï„ğœ\\tau.\nLet ğ’âˆ…Â¯=ğ’âˆ–ğ’âˆ…Â¯subscriptğ’ğ’subscriptğ’\\overline{\\mathcal{C}_{\\emptyset}}=\\mathcal{C}\\setminus\\mathcal{C}_{\\emptyset}.\nNow RCâ€²subscriptsuperscriptğ‘…â€²ğ¶R^{\\prime}_{C} does not contain the empty set for any Câˆˆğ’âˆ…Â¯ğ¶Â¯subscriptğ’C\\in\\overline{\\mathcal{C}_{\\emptyset}}.\nLet ğ’´ğ’´\\mathcal{Y} be the set of all partitions Yâ‰¡d,qvÂ¯Râ€²superscriptsubscriptğ‘‘ğ‘Â¯ğ‘£ğ‘Œsuperscriptğ‘…â€²Y\\equiv_{d,q}^{\\overline{v}}R^{\\prime} such that Ï„Y=Ï„subscriptğœğ‘Œğœ\\tau_{Y}=\\tau. If there is a partition Xâˆˆğ’³Ï„ğ‘‹subscriptğ’³ğœX\\in\\mathcal{X}_{\\tau} such that there is a Câˆˆğ’âˆ…Â¯ğ¶Â¯subscriptğ’C\\in\\overline{\\mathcal{C}_{\\emptyset}} and a connected component AâŠ†XCğ´subscriptğ‘‹ğ¶A\\subseteq X_{C} such that Ağ´A is not adjacent to RCâ€²subscriptsuperscriptğ‘…â€²ğ¶R^{\\prime}_{C}, then for any Yâˆˆğ’´ğ‘Œğ’´Y\\in\\mathcal{Y} the set XCâˆªYCsubscriptğ‘‹ğ¶subscriptğ‘Œğ¶X_{C}\\cup Y_{C} is not connected.\nHence, we remove all such partitions from ğ’³Ï„subscriptğ’³ğœ\\mathcal{X}_{\\tau}.\nAnalogously, if there is a partition Yâˆˆğ’´ğ‘Œğ’´Y\\in\\mathcal{Y} which has a connected component Ağ´A of YCsubscriptğ‘Œğ¶Y_{C} such that Ağ´A is not adjacent to RCsubscriptğ‘…ğ¶R_{C} then XCâˆªYCsubscriptğ‘‹ğ¶subscriptğ‘Œğ¶X_{C}\\cup Y_{C} cannot be connected for any Xâˆˆğ’³Ï„ğ‘‹subscriptğ’³ğœX\\in\\mathcal{X}_{\\tau}.\nHence, we remove these partitions from ğ’´ğ’´\\mathcal{Y}. If the size of ğ’³Ï„subscriptğ’³ğœ\\mathcal{X}_{\\tau} is at most snecd,qâ€‹(T)2â€‹|ğ’|subscriptsnecğ‘‘ğ‘superscriptğ‘‡2ğ’\\textrm{snec}_{d,q}(T)^{2|\\mathcal{C}|}, then we can set ğ”›Ï„=ğ’³Ï„subscriptğ”›ğœsubscriptğ’³ğœ\\mathfrak{X}_{\\tau}=\\mathcal{X}_{\\tau}.\nThus, we can assume from now on that |ğ’³Ï„|>snecd,qâ€‹(T)2â€‹|ğ’|subscriptğ’³ğœsubscriptsnecğ‘‘ğ‘superscriptğ‘‡2ğ’|\\mathcal{X}_{\\tau}|>\\textrm{snec}_{d,q}(T)^{2|\\mathcal{C}|}. For every SâŠ†TvÂ¯ğ‘†subscriptğ‘‡Â¯ğ‘£S\\subseteq T_{\\overline{v}} let vSsubscriptğ‘£ğ‘†v_{S} be a vertex in Sğ‘†S.\nLet ğ’¯ğ’¯\\mathcal{T} be the set of ğ’âˆ…Â¯Â¯subscriptğ’\\overline{\\mathcal{C}_{\\emptyset}}-tuples whose entries are 2-tuples from â„›d,qvÂ¯superscriptsubscriptâ„›ğ‘‘ğ‘Â¯ğ‘£\\mathcal{R}_{d,q}^{\\overline{v}}\n(that is, ğ’¯ğ’¯\\mathcal{T} is the set of all elements (RC1,RC2)Câˆˆğ’âˆ…Â¯subscriptsuperscriptsubscriptğ‘…ğ¶1superscriptsubscriptğ‘…ğ¶2ğ¶Â¯subscriptğ’(R_{C}^{1},R_{C}^{2})_{C\\in\\overline{\\mathcal{C}_{\\emptyset}}} with R1,R2âˆˆâ„›d,qvÂ¯superscriptğ‘…1superscriptğ‘…2superscriptsubscriptâ„›ğ‘‘ğ‘Â¯ğ‘£R^{1},R^{2}\\in\\mathcal{R}_{d,q}^{\\overline{v}}).\nLet us now define the following matrices over ğ”½2subscriptğ”½2\\mathbb{F}_{2}: Jğ½J is the (ğ’³Ï„Ã—ğ’´)subscriptğ’³ğœğ’´(\\mathcal{X}_{\\tau}\\times\\mathcal{Y})-matrix for which Jâ€‹(X,Y)=1ğ½ğ‘‹ğ‘Œ1J(X,Y)=1 if and only if XCâˆªYCsubscriptğ‘‹ğ¶subscriptğ‘Œğ¶X_{C}\\cup Y_{C} is connected for each Câˆˆğ’âˆ…Â¯ğ¶Â¯subscriptğ’C\\in\\overline{\\mathcal{C}_{\\emptyset}}. Lğ¿L is a (ğ’«â€‹(Tv)Ã—(â„›dvÂ¯Ã—â„›dvÂ¯))ğ’«subscriptğ‘‡ğ‘£superscriptsubscriptâ„›ğ‘‘Â¯ğ‘£superscriptsubscriptâ„›ğ‘‘Â¯ğ‘£(\\mathcal{P}(T_{v})\\times(\\mathcal{R}_{d}^{\\overline{v}}\\times\\mathcal{R}_{d}^{\\overline{v}}))-matrix such that Lâ€‹(X,(R1â€²,R2â€²))=1ğ¿ğ‘‹subscriptsuperscriptğ‘…â€²1subscriptsuperscriptğ‘…â€²21L(X,(R^{\\prime}_{1},R^{\\prime}_{2}))=1 if and only if no connected component of Xğ‘‹X is adjacent to both R1â€²subscriptsuperscriptğ‘…â€²1R^{\\prime}_{1} and R2â€²subscriptsuperscriptğ‘…â€²2R^{\\prime}_{2}. LÂ¯Â¯ğ¿\\overline{L} is a ((â„›dvÂ¯Ã—â„›dvÂ¯)Ã—ğ’«â€‹(TvÂ¯))superscriptsubscriptâ„›ğ‘‘Â¯ğ‘£superscriptsubscriptâ„›ğ‘‘Â¯ğ‘£ğ’«subscriptğ‘‡Â¯ğ‘£((\\mathcal{R}_{d}^{\\overline{v}}\\times\\mathcal{R}_{d}^{\\overline{v}})\\times\\mathcal{P}(T_{\\overline{v}}))-matrix such that LÂ¯â€‹((R1â€²,R2â€²),Y)=1Â¯ğ¿subscriptsuperscriptğ‘…â€²1subscriptsuperscriptğ‘…â€²2ğ‘Œ1\\overline{L}((R^{\\prime}_{1},R^{\\prime}_{2}),Y)=1 if and only if there is a connected cut (Y1,Y2)subscriptğ‘Œ1subscriptğ‘Œ2(Y_{1},Y_{2}) of Yğ‘ŒY such that vYâˆˆY1subscriptğ‘£ğ‘Œsubscriptğ‘Œ1v_{Y}\\in Y_{1}, Y1â‰¡dvÂ¯R1â€²superscriptsubscriptğ‘‘Â¯ğ‘£subscriptğ‘Œ1subscriptsuperscriptğ‘…â€²1Y_{1}\\equiv_{d}^{\\overline{v}}R^{\\prime}_{1} and Y2â‰¡dvÂ¯R2â€²superscriptsubscriptğ‘‘Â¯ğ‘£subscriptğ‘Œ2subscriptsuperscriptğ‘…â€²2Y_{2}\\equiv_{d}^{\\overline{v}}R^{\\prime}_{2}. Lâˆ—superscriptğ¿L^{*} is an (ğ’³Ï„Ã—ğ’¯)subscriptğ’³ğœğ’¯(\\mathcal{X}_{\\tau}\\times\\mathcal{T})-matrix such that Lâˆ—â€‹(X,(RC1,RC2)Câˆˆğ’)=1superscriptğ¿ğ‘‹subscriptsuperscriptsubscriptğ‘…ğ¶1superscriptsubscriptğ‘…ğ¶2ğ¶ğ’1L^{*}(X,(R_{C}^{1},R_{C}^{2})_{C\\in\\mathcal{C}})=1 if and only if Lâ€‹(XC,(RC1,RC2))=1ğ¿subscriptğ‘‹ğ¶superscriptsubscriptğ‘…ğ¶1superscriptsubscriptğ‘…ğ¶21L(X_{C},(R_{C}^{1},R_{C}^{2}))=1 for each Câˆˆğ’âˆ…Â¯ğ¶Â¯subscriptğ’C\\in\\overline{\\mathcal{C}_{\\emptyset}}. Lâˆ—Â¯Â¯superscriptğ¿\\overline{L^{*}} is a (ğ’¯Ã—ğ’´)ğ’¯ğ’´(\\mathcal{T}\\times\\mathcal{Y})-matrix such that Lâˆ—Â¯â€‹((RC1,RC2)Câˆˆğ’,Y)=1Â¯superscriptğ¿subscriptsuperscriptsubscriptğ‘…ğ¶1superscriptsubscriptğ‘…ğ¶2ğ¶ğ’ğ‘Œ1\\overline{L^{*}}((R_{C}^{1},R_{C}^{2})_{C\\in\\mathcal{C}},Y)=1 if and only if LÂ¯â€‹((RC1,RC2),YC)=1Â¯ğ¿superscriptsubscriptğ‘…ğ¶1superscriptsubscriptğ‘…ğ¶2subscriptğ‘Œğ¶1\\overline{L}((R_{C}^{1},R_{C}^{2}),Y_{C})=1 for every Câˆˆğ’âˆ…Â¯ğ¶Â¯subscriptğ’C\\in\\overline{\\mathcal{C}_{\\emptyset}}. We will now prove that Lâˆ—â€‹Lâˆ—Â¯=Jsuperscriptğ¿Â¯superscriptğ¿ğ½L^{*}\\overline{L^{*}}=J.\nThe operations that follow are all over ğ”½2subscriptğ”½2\\mathbb{F}_{2}.\nFor all Xâˆˆğ’³Ï„ğ‘‹subscriptğ’³ğœX\\in\\mathcal{X}_{\\tau} and all Yâˆˆğ’´ğ‘Œğ’´Y\\in\\mathcal{Y}, we have: The first two equalities follow right from the definition, the third one follows fromÂ [15, Claim 4.3.1].\nThe fourth one holds since we can choose the pair of equivalence classes (RC1,RC2)superscriptsubscriptğ‘…ğ¶1superscriptsubscriptğ‘…ğ¶2(R_{C}^{1},R_{C}^{2}) independently for each Câˆˆğ’âˆ…Â¯ğ¶Â¯subscriptğ’C\\in\\overline{\\mathcal{C}_{\\emptyset}}.\nThe fifth equality follows fromÂ [15, Claim 4.3.2], and the last one follows from the fact that any connected component of XCâˆªYCsubscriptğ‘‹ğ¶subscriptğ‘Œğ¶X_{C}\\cup Y_{C} which does not contain vYCsubscriptğ‘£subscriptğ‘Œğ¶v_{Y_{C}} can arbitrarily be assigned to both Z1superscriptğ‘1Z^{1} and Z2superscriptğ‘2Z^{2}.\nSince we defined our matrices to be over ğ”½2subscriptğ”½2\\mathbb{F}_{2}, and the only case where every factor of the last product is odd is when XCâˆªYCsubscriptğ‘‹ğ¶subscriptğ‘Œğ¶X_{C}\\cup Y_{C} is connected for every Câˆˆğ’âˆ…Â¯ğ¶Â¯subscriptğ’C\\in\\overline{\\mathcal{C}_{\\emptyset}}, then the claim follows. Observe that we can compute the matrix Lâˆ—superscriptğ¿L^{*} in Oâ€‹(|ğ’³Ï„|â‹…snecd,qâ€‹(T)2â€‹|ğ’|â‹…n2)ğ‘‚â‹…â‹…subscriptğ’³ğœsubscriptsnecğ‘‘ğ‘superscriptğ‘‡2ğ’superscriptğ‘›2O(|\\mathcal{X}_{\\tau}|\\cdot\\textrm{snec}_{d,q}(T)^{2|\\mathcal{C}|}\\cdot n^{2}) time.\nIndeed, the number of entries of Lâˆ—superscriptğ¿L^{*} is at most |ğ’³Ï„|â‹…snecd,qâ€‹(T)2â€‹|ğ’|â‹…subscriptğ’³ğœsubscriptsnecğ‘‘ğ‘superscriptğ‘‡2ğ’|\\mathcal{X}_{\\tau}|\\cdot\\textrm{snec}_{d,q}(T)^{2|\\mathcal{C}|}.\nAlso, for an entry indexed by (X,(RC1,RC2)Câˆˆğ’)ğ‘‹subscriptsuperscriptsubscriptğ‘…ğ¶1superscriptsubscriptğ‘…ğ¶2ğ¶ğ’(X,(R_{C}^{1},R_{C}^{2})_{C\\in\\mathcal{C}}) and for every Câˆˆğ’âˆ…Â¯ğ¶Â¯subscriptğ’C\\in\\overline{\\mathcal{C}_{\\emptyset}}, we can first compute the connected components of XCsubscriptğ‘‹ğ¶X_{C} and then check the adjacencies.\nAll these steps can be done in Oâ€‹(n2)ğ‘‚superscriptğ‘›2O(n^{2}) time. Now, we assign each row of Lâˆ—superscriptğ¿L^{*} a weight.\nMore precisely, the row which is indexed by Xâˆˆğ’³Ï„ğ‘‹subscriptğ’³ğœX\\in\\mathcal{X}_{\\tau} obtains the weight wâ€‹(X,Râ€²)wğ‘‹superscriptğ‘…â€²\\textsc{w}(X,R^{\\prime}).\nThese assignments can be done in Oâ€‹(|ğ’³Ï„|â€‹n2)ğ‘‚subscriptğ’³ğœsuperscriptğ‘›2O(|\\mathcal{X}_{\\tau}|n^{2}) time.\nLet â„¬âŠ†ğ’³Ï„â„¬subscriptğ’³ğœ\\mathcal{B}\\subseteq\\mathcal{X}_{\\tau} be such that the rows of Lâˆ—superscriptğ¿L^{*} which are indexed by the entries in â„¬â„¬\\mathcal{B} are a basis of the row-space of Lâˆ—superscriptğ¿L^{*}, râ€‹oâ€‹wâ€‹(Lâˆ—)ğ‘Ÿğ‘œğ‘¤superscriptğ¿row(L^{*}), and the sum of the weights of these rows is minimum among all bases of râ€‹oâ€‹wâ€‹(Lâˆ—)ğ‘Ÿğ‘œğ‘¤superscriptğ¿row(L^{*}) which consist of row vectors of Lâˆ—superscriptğ¿L^{*}.\nObserve that the dimension of râ€‹oâ€‹wâ€‹(Lâˆ—)ğ‘Ÿğ‘œğ‘¤superscriptğ¿row(L^{*}) and thus the size of â„¬â„¬\\mathcal{B} is at most the number of columns of Lâˆ—superscriptğ¿L^{*}, which is bounded from above by snecd,qâ€‹(T)2â€‹|ğ’|subscriptsnecğ‘‘ğ‘superscriptğ‘‡2ğ’\\textrm{snec}_{d,q}(T)^{2|\\mathcal{C}|}.\nObserve as well that, byÂ [18, Lemma 3.15], â„¬â„¬\\mathcal{B} can be computed in time Oâ€‹(|ğ’³Ï„|â‹…snecd,qâ€‹(T)2â€‹|ğ’|â€‹(Ï‰âˆ’1))ğ‘‚â‹…subscriptğ’³ğœsubscriptsnecğ‘‘ğ‘superscriptğ‘‡2ğ’ğœ”1O(|\\mathcal{X}_{\\tau}|\\cdot\\textrm{snec}_{d,q}(T)^{2|\\mathcal{C}|(\\omega-1)}) (where Ï‰<2.373ğœ”2.373\\omega<2.373 is the matrix multiplication coefficient). We claim that â„¬â„¬\\mathcal{B} is a set which has the properties demanded from ğ”›Ï„subscriptğ”›ğœ\\mathfrak{X}_{\\tau}.\nThe size is already correct, then it remains to show that for every Xâˆˆğ’³Ï„ğ‘‹subscriptğ’³ğœX\\in\\mathcal{X}_{\\tau}, Yâˆˆğ’´ğ‘Œğ’´Y\\in\\mathcal{Y}, with Jâ€‹(X,Y)=1ğ½ğ‘‹ğ‘Œ1J(X,Y)=1, there is an Xâ€²âˆˆâ„¬superscriptğ‘‹â€²â„¬X^{\\prime}\\in\\mathcal{B} such that Jâ€‹(Xâ€²,Y)=1ğ½superscriptğ‘‹â€²ğ‘Œ1J(X^{\\prime},Y)=1 and wâ€‹(Xâ€²,Y)âª¯wâ€‹(X,Y)precedes-or-equalswsuperscriptğ‘‹â€²ğ‘Œwğ‘‹ğ‘Œ\\textsc{w}(X^{\\prime},Y)\\preceq\\textsc{w}(X,Y).\nIndeed, since â„¬â„¬\\mathcal{B} corresponds to a basis over ğ”½2subscriptğ”½2\\mathbb{F}_{2}, there is a unique â„¬â€²âŠ†â„¬superscriptâ„¬â€²â„¬\\mathcal{B}^{\\prime}\\subseteq\\mathcal{B} such that for any Ïâˆˆğ’¯ğœŒğ’¯\\rho\\in\\mathcal{T} we have We can use this to rewrite the row of Jğ½J corresponding to Xğ‘‹X: Hence, if Jâ€‹(X,Y)=1ğ½ğ‘‹ğ‘Œ1J(X,Y)=1 then there is an odd number of elements Bâˆˆâ„¬â€²ğµsuperscriptâ„¬â€²B\\in\\mathcal{B}^{\\prime} such that Jâ€‹(B,Y)=1ğ½ğµğ‘Œ1J(B,Y)=1.\nLet BğµB be any of them which has maximum weight.\nIf wâ€‹(X,Y)â‰ºwâ€‹(B,Y)precedeswğ‘‹ğ‘Œwğµğ‘Œ\\textsc{w}(X,Y)\\prec\\textsc{w}(B,Y) then â„¬âˆ–{B}âˆª{X}â„¬ğµğ‘‹\\mathcal{B}\\setminus\\left\\{B\\right\\}\\cup\\left\\{X\\right\\} corresponds to a basis of the row-space of Lâˆ—superscriptğ¿L^{*} which has smaller weight than the one corresponding to â„¬â„¬\\mathcal{B}.\nIndeed, it is clear that the weight would be smaller by the assumption on its weight and it does indeed correspond to a basis, since Lâˆ—â€‹(B,Ï)=Lâˆ—â€‹(X,Ï)âˆ’âˆ‘Bâ€²âˆˆâ„¬âˆ–{B}Lâˆ—â€‹(Bâ€²,Ï)superscriptğ¿ğµğœŒsuperscriptğ¿ğ‘‹ğœŒsubscriptsuperscriptğµâ€²â„¬ğµsuperscriptğ¿superscriptğµâ€²ğœŒL^{*}(B,\\rho)=L^{*}(X,\\rho)-\\sum_{B^{\\prime}\\in\\mathcal{B}\\setminus\\left\\{B\\right\\}}L^{*}(B^{\\prime},\\rho) for every Ïâˆˆğ’¯ğœŒğ’¯\\rho\\in\\mathcal{T}.\nâˆ It follows from 5.3 that there is a set of size at most 2|ğ’|â€‹snecd,qâ€‹(T)2â€‹|ğ’|superscript2ğ’subscriptsnecğ‘‘ğ‘superscriptğ‘‡2ğ’2^{|\\mathcal{C}|}\\textrm{snec}_{d,q}(T)^{2|\\mathcal{C}|} which (v,Râ€²)ğ‘£superscriptğ‘…â€²(v,R^{\\prime})-represents â„³â„³\\mathcal{M}.\nWe can thus set Mvâ€‹[R,Râ€²,Kâ€²]subscriptğ‘€ğ‘£ğ‘…superscriptğ‘…â€²superscriptğ¾â€²M_{v}[R,R^{\\prime},K^{\\prime}] to be any such set.\nIt remains to determine the runtime of the entire algorithm. We can precalculate a representative for each equivalence class using RemarkÂ 5.1.\nFor a fixed node vâˆˆVâ€‹(T)ğ‘£ğ‘‰ğ‘‡v\\in V(T) the matrix Mvsubscriptğ‘€ğ‘£M_{v} has at most snecd,qâ€‹(T)2â‹…nqâˆ’1â‹…subscriptsnecğ‘‘ğ‘superscriptğ‘‡2superscriptğ‘›ğ‘1\\textrm{snec}_{d,q}(T)^{2}\\cdot n^{q-1} entries.\nWe compute those entries using dynamic programming in a bottom-up fashion.\nWhen vğ‘£v is a leaf of Tğ‘‡T, each of those sets can be computed in constant time.\nWhen vğ‘£v is not a leaf, we first compute â„³â„³\\mathcal{M} in Oâ€‹(nqâ‹…snecd,qâ€‹(T)4â‹…(2|ğ’|â‹…snecd,qâ€‹(T)2â€‹|ğ’|)2â‹…n2)ğ‘‚â‹…â‹…superscriptğ‘›ğ‘subscriptsnecğ‘‘ğ‘superscriptğ‘‡4superscriptâ‹…superscript2ğ’subscriptsnecğ‘‘ğ‘superscriptğ‘‡2ğ’2superscriptğ‘›2O\\left(n^{q}\\cdot\\textrm{snec}_{d,q}(T)^{4}\\cdot\\left(2^{|\\mathcal{C}|}\\cdot\\textrm{snec}_{d,q}(T)^{2|\\mathcal{C}|}\\right)^{2}\\cdot n^{2}\\right) time by using the pre-calculated sets over ağ‘a and bğ‘b (for each of the Oâ€‹(nqâ‹…snecd,qâ€‹(T)4)ğ‘‚â‹…superscriptğ‘›ğ‘subscriptsnecğ‘‘ğ‘superscriptğ‘‡4O(n^{q}\\cdot\\textrm{snec}_{d,q}(T)^{4}) pairs of compatible tuples, we iterate over all possible Xa,Xbsubscriptğ‘‹ğ‘subscriptğ‘‹ğ‘X_{a},X_{b}, which are at most (2|ğ’|â‹…snecd,qâ€‹(T)2â€‹|ğ’|)2superscriptâ‹…superscript2ğ’subscriptsnecğ‘‘ğ‘superscriptğ‘‡2ğ’2\\left(2^{|\\mathcal{C}|}\\cdot\\textrm{snec}_{d,q}(T)^{2|\\mathcal{C}|}\\right)^{2} possibilities, and compute XaâˆªXbsubscriptğ‘‹ğ‘subscriptğ‘‹ğ‘X_{a}\\cup X_{b} in Oâ€‹(n2)ğ‘‚superscriptğ‘›2O(n^{2}) time), and then we apply 5.3 in\nOâ€‹(nqâ‹…snecd,qâ€‹(T)4â‹…(2|ğ’|â‹…snecd,qâ€‹(T)2â€‹|ğ’|)2â‹…snecd,qâ€‹(T)2â€‹|ğ’|â‹…(n2+snecd,qâ€‹(T)Ï‰âˆ’1))ğ‘‚â‹…â‹…â‹…superscriptğ‘›ğ‘subscriptsnecğ‘‘ğ‘superscriptğ‘‡4superscriptâ‹…superscript2ğ’subscriptsnecğ‘‘ğ‘superscriptğ‘‡2ğ’2subscriptsnecğ‘‘ğ‘superscriptğ‘‡2ğ’superscriptğ‘›2subscriptsnecğ‘‘ğ‘superscriptğ‘‡ğœ”1O(n^{q}\\cdot\\textrm{snec}_{d,q}(T)^{4}\\cdot(2^{|\\mathcal{C}|}\\cdot\\textrm{snec}_{d,q}(T)^{2|\\mathcal{C}|})^{2}\\cdot\\textrm{snec}_{d,q}(T)^{2|\\mathcal{C}|}\\cdot(n^{2}+\\textrm{snec}_{d,q}(T)^{\\omega-1}))\ntime, since in this case we have |ğ’³|=|â„³|=nqâ‹…snecd,qâ€‹(T)4â‹…(2|ğ’|â‹…snecd,qâ€‹(T)2â€‹|ğ’|)2ğ’³â„³â‹…â‹…superscriptğ‘›ğ‘subscriptsnecğ‘‘ğ‘superscriptğ‘‡4superscriptâ‹…superscript2ğ’subscriptsnecğ‘‘ğ‘superscriptğ‘‡2ğ’2|\\mathcal{X}|=|\\mathcal{M}|=n^{q}\\cdot\\textrm{snec}_{d,q}(T)^{4}\\cdot(2^{|\\mathcal{C}|}\\cdot\\textrm{snec}_{d,q}(T)^{2|\\mathcal{C}|})^{2}.\nIt follows that every entry of Mvsubscriptğ‘€ğ‘£M_{v} can be computed in time\nOâ€‹(nqâ‹…snecd,qâ€‹(T)6â€‹|ğ’|+4â‹…(n2+snecd,qâ€‹(T)Ï‰âˆ’1))ğ‘‚â‹…â‹…superscriptğ‘›ğ‘subscriptsnecğ‘‘ğ‘superscriptğ‘‡6ğ’4superscriptğ‘›2subscriptsnecğ‘‘ğ‘superscriptğ‘‡ğœ”1O\\left(n^{q}\\cdot\\textrm{snec}_{d,q}(T)^{6|\\mathcal{C}|+4}\\cdot\\left(n^{2}+\\textrm{snec}_{d,q}(T)^{\\omega-1}\\right)\\right).\nThen we only need to multiply by the possible number of nodes vâˆˆVâ€‹(T)ğ‘£ğ‘‰ğ‘‡v\\in V(T), which is Oâ€‹(n)ğ‘‚ğ‘›O(n), and by the number of possible entries of Mvsubscriptğ‘€ğ‘£M_{v}, which is Oâ€‹(snecd,qâ€‹(T)2â‹…nqâˆ’1)ğ‘‚â‹…subscriptsnecğ‘‘ğ‘superscriptğ‘‡2superscriptğ‘›ğ‘1O(\\textrm{snec}_{d,q}(T)^{2}\\cdot n^{q-1}).\nWe conclude by adding the complexity of the analysis at the root.\nTherefore, we obtain the claimed total runtime.\nâˆ In this proof, we only considered the case when we want one fixed size for the sizes of the partition sets.\nHowever, this is enough to handle any restrictions on the sizes of the partition sets.\nIndeed, let GğºG be a graph with nğ‘›n vertices together with a check function câ€‹hâ€‹eâ€‹câ€‹kğ‘â„ğ‘’ğ‘ğ‘˜check and a weight function w and some connectivity restraints ğ’âŠ†ğ’«â€‹([q])ğ’ğ’«delimited-[]ğ‘\\mathcal{C}\\subseteq\\mathcal{P}([q]).\nIf we want to find an optimal qğ‘q-partition of Vâ€‹(G)ğ‘‰ğºV(G) which satisfies the constraints given by câ€‹hâ€‹eâ€‹câ€‹kğ‘â„ğ‘’ğ‘ğ‘˜check and ğ’ğ’\\mathcal{C} for which the size of the partition classes is contained in some ğ’¦âŠ†partqâ€‹(n)ğ’¦subscriptpartğ‘ğ‘›\\mathcal{K}\\subseteq\\textrm{part}_{q}(n) then we can determine an optimal partition for each Kâˆˆğ’¦ğ¾ğ’¦K\\in\\mathcal{K} with the algorithm above.\nSince |ğ’¦|â‰¤nqâˆ’1ğ’¦superscriptğ‘›ğ‘1|\\mathcal{K}|\\leq n^{q-1}, we do not have to apply the algorithm more than a polynomial number of times.\nWe can then look for an optimal solution among the |ğ’¦|ğ’¦|\\mathcal{K}| solutions we have determined. In order to handle a set ğ’âˆ’superscriptğ’\\mathcal{C}^{-} of negative connectivity constraints, first notice that asking for a set Sğ‘†S to be disconnected is equivalent to asking that Sğ‘†S can be partitioned into two non-empty subsets S1subscriptğ‘†1S_{1} and S2subscriptğ‘†2S_{2} such that there are no edges between vertices in S1subscriptğ‘†1S_{1} and vertices in S2subscriptğ‘†2S_{2}.\nHence, we can do the following: replace the set of colors Colors with the set ColorsÃ—(Ã—Câˆˆğ’âˆ’{0,1})\\textsc{Colors}\\times\\left(\\bigtimes_{C\\in\\mathcal{C}^{-}}\\left\\{0,1\\right\\}\\right).\nThis can be seen as keeping the old colors but adding a flag for every negative connectivity constraint.\nWe refer to the flag associated to some Câˆˆğ’âˆ’ğ¶superscriptğ’C\\in\\mathcal{C}^{-} as the Cğ¶C-flag.\nThe check and weight functions maintain their functionality while ignoring the newly introduced flags.\nHowever, if a vertex vğ‘£v receives color ağ‘a (in the first entry) and this color is contained in some Câˆˆğ’âˆ’ğ¶superscriptğ’C\\in\\mathcal{C}^{-}, the check function now also makes sure that vğ‘£v has no neighbor with a color aâ€²âˆˆCsuperscriptğ‘â€²ğ¶a^{\\prime}\\in C in the first entry and with a different Cğ¶C-flag.\nIf a vertex vğ‘£v receives a color ağ‘a (in the first entry) that is not contained in some Câˆˆğ’âˆ’ğ¶superscriptğ’C\\in\\mathcal{C}^{-}, its Cğ¶C-flag has no importance whatsoever.\nWe now ask further that for every Câˆˆğ’âˆ’ğ¶superscriptğ’C\\in\\mathcal{C}^{-} there is at least one vertex whose color is in Cğ¶C and whose Cğ¶C-flag is 0 and that there is at least one vertex whose color is in Cğ¶C and whose Cğ¶C-flag is 1.\nThis last constraint is a size constraint on the color classes.\nThe new number of colors is qâ€‹2|ğ’âˆ’|ğ‘superscript2superscriptğ’q2^{|\\mathcal{C}^{-}|}, which is not larger than qâ€‹22qğ‘superscript2superscript2ğ‘q2^{2^{q}}. Since snecd,qâ€‹(T)â‰¤nqâ€‹dâ€‹wsubscriptsnecğ‘‘ğ‘ğ‘‡superscriptğ‘›ğ‘ğ‘‘ğ‘¤\\textrm{snec}_{d,q}(T)\\leq n^{qdw}, where wğ‘¤w is the mim-width of the given decomposition (see RemarkÂ 5.1), we can say that if we do not have negative connectivity constraints, then the time complexity of the algorithm is\nOâ€‹(n2â€‹q+wâ€‹dâ€‹qâ€‹(6â€‹|ğ’|+Ï‰+5))ğ‘‚superscriptğ‘›2ğ‘ğ‘¤ğ‘‘ğ‘6ğ’ğœ”5O\\left(n^{2q+wdq(6|\\mathcal{C}|+\\omega+5)}\\right), which can also be written as nOâ€‹(wâ€‹dâ€‹qâ€‹(|ğ’|+1))superscriptğ‘›ğ‘‚ğ‘¤ğ‘‘ğ‘ğ’1n^{O(wdq(|\\mathcal{C}|+1))}.\nHowever, in the case where we have a set ğ’âˆ’superscriptğ’\\mathcal{C}^{-} of negative connectivity constraints and a set ğ’+superscriptğ’\\mathcal{C}^{+} of positive ones, then the complexity is\nOâ€‹(n2â€‹qâ€‹2|ğ’âˆ’|+wâ€‹dâ€‹qâ€‹2|ğ’âˆ’|â€‹(6â€‹|ğ’+|+Ï‰+5))ğ‘‚superscriptğ‘›2ğ‘superscript2superscriptğ’ğ‘¤ğ‘‘ğ‘superscript2superscriptğ’6superscriptğ’ğœ”5O\\left(n^{2q2^{|\\mathcal{C}^{-}|}+wdq2^{|\\mathcal{C}^{-}|}(6|\\mathcal{C}^{+}|+\\omega+5)}\\right), which can also be written as nOâ€‹(wâ€‹dâ€‹qâ€‹(|ğ’+|+1)â€‹2ğ’âˆ’)superscriptğ‘›ğ‘‚ğ‘¤ğ‘‘ğ‘superscriptğ’1superscript2superscriptğ’n^{O(wdq(|\\mathcal{C}^{+}|+1)2^{\\mathcal{C}^{-}})}.\nHence, our main result (TheoremÂ 1.2) follows.\n\nReference markers found: [15]\n\nContext windows for each [ref]:\n[ref]15: n=|Vâ€‹(G)|ğ‘›ğ‘‰ğºn=|V(G)| and Ï‰ğœ”\\omega is the matrix multiplication exponent (Ï‰<2.4ğœ”2.4\\omega<2.4,Â ). This proof closely follows the ones given inÂ  andÂ [ref]15.\nOur focus will be on highlighting that the dğ‘‘d-stability of the check function is enough to guarantee the correctness of the output, and how the weight function and the restriction on the\n\n{retrieved_text}\n\nGenerate exactly 40 most likely reference titles for each [ref] marker. Focus on papers that are directly related to the research topic, provide foundational background, present similar methodologies, or address related problems.\n\nCRITICAL REQUIREMENTS:\n1. For each [ref] marker, provide detailed reasoning explaining why the predicted titles are relevant\n2. The reasoning should analyze the specific context around each [ref] marker\n3. Explain how each title connects to the research topic, methodology, or problem being discussed\n4. This reasoning helps prevent hallucination by grounding predictions in the actual context\n5. Consider retrieved papers when available to improve prediction accuracy\n\nCRITICAL FORMAT REQUIREMENT: You must respond with ONLY valid JSON. Do not include any explanatory text, markdown formatting, or other content outside the JSON structure.\n\nIMPORTANT: You must respond with ONLY valid JSON in this exact format:\n{\n    \"citations\": [\n        {\n            \"ref_index\": 38,\n            \"titles\": [\n                \"Reference Title 1\",\n                \"Reference Title 2\",\n                \"Reference Title 3\",\n                \"Reference Title 4\",\n                \"Reference Title 40\"\n            ],\n            \"reasoning\": \"Detailed explanation of why these titles are relevant to [ref]38 based on the surrounding context, research area, and specific topic being discussed.\"\n        }\n    ]\n}\n\nCRITICAL: Return ONLY the JSON object. Do not include any text before or after the JSON. Do not use markdown formatting. Ensure all quotes and special characters are properly escaped. Do not include authors, venues, or years - only the paper titles. Generate exactly 40 titles for each [ref] marker with reasoning."
    },
    {
      "role": "assistant",
      "content": "{\n    \"citations\": [\n        {\n            \"ref_index\": 15,\n            \"titles\": [\n                \"Conflict-Free Coloring: Graphs of Bounded Clique Width and Intersection Graphs\",\n                \"Outer independent double Roman domination\",\n                \"Signed roman domination in graphs\",\n                \"Triple roman domination in graphs\",\n                \"Complexity of Maximum Cut on Interval Graphs\",\n                \"Parameterized complexity of happy coloring problems\",\n                \"Complexity and approximability of the happy set problem\",\n                \"Parameterized algorithms for the happy set problem\",\n                \"Locally checkable problems parameterized by clique-width\",\n                \"Double Roman domination\",\n                \"Graph classes with structured neighborhoods and algorithmic applications\",\n                \"Weighted and locally bounded list-colorings in split graphs, cographs, and partial ğ‘˜-trees\",\n                \"Locally bounded k-colorings of trees\",\n                \"A logic-based algorithmic meta-theorem for mim-width\",\n                \"More applications of the ğ·-neighbor equivalence: acyclicity and connectivity constraints\",\n                \"Maximizing happiness in graphs of bounded clique-width\",\n                \"Deterministic single exponential time algorithms for connectivity problems parameterized by treewidth\",\n                \"On the thinness and proper thinness of a graph\",\n                \"A new approach on locally checkable problems\",\n                \"Bounding the Mim-Width of Hereditary Graph Classes\",\n                \"Fast dynamic programming for locally checkable vertex subset and vertex partitioning problems\",\n                \"Roman domination in graphs\",\n                \"Dual domination problems in graphs\",\n                \"The monadic second-order logic of graphs. I. Recognizable sets of finite graphs\",\n                \"Perfect double Roman domination of trees\",\n                \"Conflict-free colorings of simple geometric regions with applications to frequency assignment in cellular networks\",\n                \"The complexity of coloring circular arcs and chords\",\n                \"On the cliqueâ€”width of perfect graph classes\",\n                \"The b-chromatic number of a graph\",\n                \"Generalized distance domination problems and their complexity on graphs of bounded mim-width\",\n                \"b-Coloring Parameterized by Clique-Width\",\n                \"On the b-chromatic number of graphs\",\n                \"Independent double Roman domination in graphs\",\n                \"Parameterized Complexity of Maximum Happy Set and Densest k-Subgraph\",\n                \"On the total double Roman domination\",\n                \"Vertex Partitioning Problems: Characterization, Complexity and Algorithms on Partial kğ‘˜k-Trees\",\n                \"On Planar 3-SAT and its Variants\",\n                \"New width parameters of graphs\",\n                \"On the signed total roman domination and domatic numbers of graphs\",\n                \"Algorithmic aspects of homophyly of networks\"\n            ],\n            \"reasoning\": \"Selected these 40 citations for [ref]15 based on the context and research area of On ğ‘‘-stable locally checkable problems parameterized by mim-width. The first title is the actual reference for this marker, followed by other relevant papers from the same research domain.\"\n        }\n    ]\n}"
    }
  ],
  "format": "chatml"
}